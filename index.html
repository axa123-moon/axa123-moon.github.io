<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.0.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha256-CTSx/A06dm1B063156EVh15m6Y67pAjZZaQc89LLSrU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"axa123-moon.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.18.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="AI Beginner&#39;s Blog">
<meta property="og:url" content="https://axa123-moon.github.io/index.html">
<meta property="og:site_name" content="AI Beginner&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="axa123">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://axa123-moon.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>AI Beginner's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">AI Beginner's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">axa123</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">22</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">66</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://axa123-moon.github.io/2024/04/01/TF-IDF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="axa123">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/01/TF-IDF/" class="post-title-link" itemprop="url">TF IDF</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-04-01 14:02:40 / Modified: 15:13:05" itemprop="dateCreated datePublished" datetime="2024-04-01T14:02:40+09:00">2024-04-01</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="TF-IDF-Term-Frequency-Inverse-Document-Frequency"><a href="#TF-IDF-Term-Frequency-Inverse-Document-Frequency" class="headerlink" title="TF-IDF (Term Frequency-Inverse Document Frequency)"></a>TF-IDF (Term Frequency-Inverse Document Frequency)</h1><ul>
<li>Document Term Matrix(DTM) 내 단어마다 중요도를 고려하여 가중치를 주는 통계적인 단어 표현방법</li>
</ul>
<h2 id="1-TF-IDF-계산방법"><a href="#1-TF-IDF-계산방법" class="headerlink" title="1. TF-IDF 계산방법"></a>1. TF-IDF 계산방법</h2><ul>
<li>TF-IDF &#x3D; TF * IDF</li>
</ul>
<h2 id="2-TF-Term-Frequency"><a href="#2-TF-Term-Frequency" class="headerlink" title="2. TF (Term Frequency)"></a>2. TF (Term Frequency)</h2><ul>
<li>특정 문서 d 에서 특정 단어 t의 출현빈도</li>
<li>tf(d, t)</li>
</ul>
<p>문서1 : 사과가 맛있다<br>문서2 : 사과 가격이 비싸다<br>문서3 : 아침에 사과가 좋다<br>문서4 : 배 가격이 사과 가격보다 비싸다</p>
<p><img src="/images/TFIDF/01.PNG"></p>
<h2 id="3-DF-Document-Frequency"><a href="#3-DF-Document-Frequency" class="headerlink" title="3. DF (Document Frequency)"></a>3. DF (Document Frequency)</h2><ul>
<li>특정 단어 t가 등장한 문서의 수</li>
<li>df(t)</li>
</ul>
<p><img src="/images/TFIDF/02.PNG"></p>
<h2 id="4-IDF-Inverse-Document-Frequency"><a href="#4-IDF-Inverse-Document-Frequency" class="headerlink" title="4. IDF (Inverse Document Frequency)"></a>4. IDF (Inverse Document Frequency)</h2><ul>
<li>DF에 역수</li>
<li>여러 문서에서 등장한 단어의 가중치를 낮추는 역할</li>
<li>log 안의 식에서 분모에 1을 더해주는 이유는 특정 단어가 전체 문서에서 등장하지 않을 경우에 분모가 0이 되는것을 방지</li>
<li>D : 문서 갯수<br>idf(d,t) &#x3D; log(D&#x2F;(1 + df(t)))</li>
</ul>
<p>맛있다의 경우<br>0.693147 &#x3D; log(4&#x2F;(1+1))</p>
<p><img src="/images/TFIDF/04.PNG"></p>
<h2 id="5-TF-IDF"><a href="#5-TF-IDF" class="headerlink" title="5. TF-IDF"></a>5. TF-IDF</h2><ul>
<li>TF-IDF &#x3D; TF * IDF<br><img src="/images/TFIDF/03.PNG"></li>
</ul>
<h2 id="6-Coding"><a href="#6-Coding" class="headerlink" title="6. Coding"></a>6. Coding</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> CountVectorizer</span><br><span class="line"></span><br><span class="line">documents = [</span><br><span class="line">    <span class="string">&quot;사과가 맛있다&quot;</span>,</span><br><span class="line">    <span class="string">&quot;사과 가격이 비싸다&quot;</span>,</span><br><span class="line">    <span class="string">&quot;아침에 사과가 좋다&quot;</span>,</span><br><span class="line">    <span class="string">&quot;배 가격이 사과 가격보다 비싸다&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">cv = CountVectorizer()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Document Term Matrix</span></span><br><span class="line">X = cv.fit_transform(documents).toarray()</span><br><span class="line"></span><br><span class="line"><span class="comment"># get the feature names</span></span><br><span class="line">features = cv.get_feature_names_out()</span><br><span class="line"></span><br><span class="line"><span class="comment"># create a DataFrame from the bag of words representation</span></span><br><span class="line">tf = pd.DataFrame(X, columns=features)</span><br><span class="line">tf</span><br></pre></td></tr></table></figure>
<p><img src="/images/TFIDF/01.PNG"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Document Frequency </span></span><br><span class="line">df = tf.astype(<span class="built_in">bool</span>).<span class="built_in">sum</span>(axis = <span class="number">0</span>)</span><br><span class="line">df</span><br></pre></td></tr></table></figure>
<p><img src="/images/TFIDF/02.PNG"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 문서 개수</span></span><br><span class="line">D = <span class="built_in">len</span>(tf)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Inverse Document Frequency</span></span><br><span class="line">idf = np.log((D) / (df+<span class="number">1</span>))</span><br><span class="line">idf</span><br></pre></td></tr></table></figure>
<p><img src="/images/TFIDF/04.PNG"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TF-IDF</span></span><br><span class="line">tfidf = tf * idf                      </span><br><span class="line"><span class="comment">#tfidf = tfidf / np.linalg.norm(tfidf, axis = 1, keepdims = True)</span></span><br><span class="line">tfidf</span><br></pre></td></tr></table></figure>
<p><img src="/images/TFIDF/03.PNG"></p>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a target="_blank" rel="noopener" href="https://m.blog.naver.com/mk_crew/222070694314">https://m.blog.naver.com/mk_crew/222070694314</a><br><a target="_blank" rel="noopener" href="https://heytech.tistory.com/337">https://heytech.tistory.com/337</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://axa123-moon.github.io/2024/03/27/Text-Preprocessing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="axa123">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/03/27/Text-Preprocessing/" class="post-title-link" itemprop="url">Text Preprocessing</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-03-27 17:00:31 / Modified: 17:53:31" itemprop="dateCreated datePublished" datetime="2024-03-27T17:00:31+09:00">2024-03-27</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Text-Preprocessing"><a href="#Text-Preprocessing" class="headerlink" title="Text Preprocessing"></a>Text Preprocessing</h1><ol>
<li>Tokenization<br>  1.1. 단어 토큰화<br>  1.2. 문장 토큰화</li>
<li>Cleaning</li>
<li>Normalization<br>  3.1. Stemming<br>  3.2. Lemmatization</li>
<li>Edit Distance</li>
</ol>
<h2 id="1-Tokenization"><a href="#1-Tokenization" class="headerlink" title="1. Tokenization"></a>1. Tokenization</h2><ul>
<li>주어진 데이터를 토큰(Token)이라 불리는 단위로 나누는 작업</li>
</ul>
<h3 id="1-1-단어-토큰화"><a href="#1-1-단어-토큰화" class="headerlink" title="1.1  단어 토큰화"></a>1.1  단어 토큰화</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line">nltk.download(<span class="string">&#x27;punkt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> nltk.tokenize <span class="keyword">import</span> word_tokenize</span><br><span class="line"><span class="keyword">from</span> nltk.tokenize <span class="keyword">import</span> WordPunctTokenizer</span><br><span class="line"><span class="keyword">from</span> nltk.tokenize <span class="keyword">import</span> TreebankWordTokenizer</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">&quot;Although we may not be fully aware of natural language, we need to master several preprocessing techniques to perform natural language processing.&quot;</span></span><br><span class="line"></span><br><span class="line">word_tokenize(text)</span><br></pre></td></tr></table></figure>

<p>[‘Although’,<br> ‘we’,<br> ‘may’,<br> ‘not’,<br> ‘be’,<br> ‘fully’,<br> ‘aware’,<br> ‘of’,<br> ‘natural’,<br> ‘language’,<br> ‘,’,<br> ‘we’,<br> ‘need’,<br> ‘to’,<br> ‘master’,<br> ‘several’,<br> ‘preprocessing’,<br> ‘techniques’,<br> ‘to’,<br> ‘perform’,<br> ‘natural’,<br> ‘language’,<br> ‘processing’,<br> ‘.’]</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">punct_tokenizer = WordPunctTokenizer() </span><br><span class="line">punct_tokenizer.tokenize(text)</span><br></pre></td></tr></table></figure>
<p>[‘Although’,<br> ‘we’,<br> ‘may’,<br> ‘not’,<br> ‘be’,<br> ‘fully’,<br> ‘aware’,<br> ‘of’,<br> ‘natural’,<br> ‘language’,<br> ‘,’,<br> ‘we’,<br> ‘need’,<br> ‘to’,<br> ‘master’,<br> ‘several’,<br> ‘preprocessing’,<br> ‘techniques’,<br> ‘to’,<br> ‘perform’,<br> ‘natural’,<br> ‘language’,<br> ‘processing’,<br> ‘.’]</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tree_tokenizer = TreebankWordTokenizer()</span><br><span class="line">tree_tokenizer.tokenize(text)</span><br></pre></td></tr></table></figure>

<p>[‘Although’,<br> ‘we’,<br> ‘may’,<br> ‘not’,<br> ‘be’,<br> ‘fully’,<br> ‘aware’,<br> ‘of’,<br> ‘natural’,<br> ‘language’,<br> ‘,’,<br> ‘we’,<br> ‘need’,<br> ‘to’,<br> ‘master’,<br> ‘several’,<br> ‘preprocessing’,<br> ‘techniques’,<br> ‘to’,<br> ‘perform’,<br> ‘natural’,<br> ‘language’,<br> ‘processing’,<br> ‘.’]</p>
<h3 id="1-2-문장-토큰화"><a href="#1-2-문장-토큰화" class="headerlink" title="1.2  문장 토큰화"></a>1.2  문장 토큰화</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sentences = <span class="string">&quot;NLP stands for Natural Language Processing. \</span></span><br><span class="line"><span class="string">It is a branch of artificial intelligence that focuses on the interaction between computers and human languages. \</span></span><br><span class="line"><span class="string">NLP combines techniques from linguistics, computer science, and machine learning to enable computers to understand and interpret. \</span></span><br><span class="line"><span class="string">And it creates human language in a meaningful and useful way.&quot;</span></span><br><span class="line"></span><br><span class="line">nltk.sent_tokenize(sentences)</span><br></pre></td></tr></table></figure>

<p>[‘NLP stands for Natural Language Processing.’,<br> ‘It is a branch of artificial intelligence that focuses on the interaction between computers and human languages.’,<br> ‘NLP combines techniques from linguistics, computer science, and machine learning to enable computers to understand and interpret.’,<br> ‘And it creates human language in a meaningful and useful way.’]</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sentences = <span class="string">&quot;I am actively looking for Ph.D. students. and you are a Ph.D student.&quot;</span></span><br><span class="line">nltk.sent_tokenize(sentences)</span><br></pre></td></tr></table></figure>

<p>[‘I am actively looking for Ph.D. students.’, ‘and you are a Ph.D student.’]</p>
<h2 id="2-Cleaning"><a href="#2-Cleaning" class="headerlink" title="2. Cleaning"></a>2. Cleaning</h2><ul>
<li>토큰화 작업에 방해가 되거나 의미가 없는 부분의 텍스트, 노이즈를 제거</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> stopwords</span><br><span class="line">nltk.download(<span class="string">&#x27;stopwords&#x27;</span>)</span><br><span class="line"></span><br><span class="line">stop=<span class="built_in">set</span>(stopwords.words(<span class="string">&#x27;english&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(stop)</span><br></pre></td></tr></table></figure>

<p>{‘i’, ‘don’, ‘just’, ‘been’, ‘into’, ‘ve’, ‘should’, ‘this’, “shouldn’t”, ‘yours’, ‘but’, “aren’t”, ‘your’, ‘about’, “needn’t”, ‘m’, ‘itself’, ‘other’, ‘wasn’, “wouldn’t”, ‘too’, ‘haven’, “doesn’t”, “mightn’t”, ‘hasn’, ‘didn’, ‘once’, ‘and’, “you’ll”, ‘won’, ‘we’, ‘his’, ‘both’, ‘needn’, “you’re”, ‘do’, ‘how’, ‘me’, ‘further’, ‘ain’, ‘an’, ‘isn’, ‘herself’, “wasn’t”, ‘their’, “you’ve”, ‘yourself’, ‘against’, ‘while’, ‘down’, ‘had’, ‘up’, ‘over’, ‘any’, ‘him’, ‘being’, ‘you’, ‘than’, ‘out’, “hasn’t”, ‘more’, ‘off’, ‘can’, “it’s”, ‘is’, ‘during’, ‘aren’, ‘the’, “haven’t”, ‘then’, ‘these’, ‘them’, ‘be’, ‘shan’, ‘whom’, ‘has’, ‘under’, ‘such’, ‘ll’, ‘no’, ‘all’, ‘they’, ‘through’, ‘am’, “you’d”, “weren’t”, ‘wouldn’, ‘with’, ‘in’, ‘my’, ‘on’, ‘that’, ‘if’, ‘was’, ‘why’, ‘ours’, ‘did’, ‘only’, “she’s”, ‘her’, ‘own’, ‘mightn’, ‘mustn’, ‘y’, ‘s’, ‘not’, “isn’t”, ‘where’, ‘few’, ‘by’, ‘our’, ‘so’, ‘most’, ‘of’, ‘because’, ‘have’, ‘re’, ‘as’, ‘are’, “shan’t”, ‘having’, ‘a’, ‘ourselves’, ‘which’, ‘to’, ‘from’, ‘each’, ‘or’, ‘until’, ‘t’, ‘who’, ‘d’, ‘there’, ‘doesn’, ‘himself’, ‘what’, ‘here’, ‘hers’, ‘at’, “didn’t”, ‘hadn’, ‘were’, ‘below’, ‘very’, ‘ma’, ‘now’, ‘it’, ‘those’, ‘some’, ‘themselves’, “that’ll”, ‘does’, ‘shouldn’, ‘between’, ‘when’, ‘after’, ‘myself’, ‘theirs’, ‘doing’, ‘again’, ‘o’, ‘yourselves’, ‘for’, “won’t”, “hadn’t”, ‘same’, “mustn’t”, ‘she’, ‘nor’, ‘above’, “should’ve”, ‘couldn’, “couldn’t”, ‘he’, ‘will’, “don’t”, ‘weren’, ‘its’, ‘before’}</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sentence=<span class="string">&quot;I want to go shopping and buy snacks&quot;</span></span><br><span class="line">tokens=nltk.word_tokenize(sentence)</span><br><span class="line"></span><br><span class="line">clean_tokens=[]</span><br><span class="line"><span class="keyword">for</span> tok <span class="keyword">in</span> tokens:</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">len</span>(tok.lower())&gt;<span class="number">1</span> <span class="keyword">and</span> (tok.lower() <span class="keyword">not</span> <span class="keyword">in</span> stop): </span><br><span class="line">    clean_tokens.append(tok) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;정상 문장: &quot;</span>,tokens)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;불용어 제거: &quot;</span>,clean_tokens)</span><br></pre></td></tr></table></figure>

<p>정상 문장:  [‘I’, ‘want’, ‘to’, ‘go’, ‘shopping’, ‘and’, ‘buy’, ‘snacks’]<br>불용어 제거:  [‘want’, ‘go’, ‘shopping’, ‘buy’, ‘snacks’]</p>
<h2 id="3-Normalization"><a href="#3-Normalization" class="headerlink" title="3. Normalization"></a>3. Normalization</h2><ul>
<li>의미가 중복되거나 의미론적으로 유사한 단어들을 하나로 통합하거나, 단어의 원형을 찾아 통일해주는 작업</li>
</ul>
<h3 id="3-1-Stemming-어간-추출"><a href="#3-1-Stemming-어간-추출" class="headerlink" title="3.1. Stemming (어간 추출)"></a>3.1. Stemming (어간 추출)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> nltk.stem <span class="keyword">import</span> PorterStemmer</span><br><span class="line"><span class="keyword">from</span> nltk.tokenize <span class="keyword">import</span> word_tokenize</span><br><span class="line"></span><br><span class="line">stem = PorterStemmer() <span class="comment"># stemmer 선언</span></span><br><span class="line">text = <span class="string">&quot;This was not the map we found on Billy Bonds&#x27; chest, but the exact copy of everything, name and height and sound, except for the red cross and the written note.&quot;</span></span><br><span class="line">words = word_tokenize(text)</span><br><span class="line"><span class="built_in">print</span>(words)</span><br></pre></td></tr></table></figure>

<p>[‘This’, ‘was’, ‘not’, ‘the’, ‘map’, ‘we’, ‘found’, ‘on’, ‘Billy’, ‘Bonds’, “‘“, ‘chest’, ‘,’, ‘but’, ‘the’, ‘exact’, ‘copy’, ‘of’, ‘everything’, ‘,’, ‘name’, ‘and’, ‘height’, ‘and’, ‘sound’, ‘,’, ‘except’, ‘for’, ‘the’, ‘red’, ‘cross’, ‘and’, ‘the’, ‘written’, ‘note’, ‘.’]</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> words:</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;i&#125;</span> --&gt; <span class="subst">&#123;stem.stem(i)&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>This –&gt; thi<br>was –&gt; wa<br>not –&gt; not<br>the –&gt; the<br>map –&gt; map<br>we –&gt; we<br>found –&gt; found<br>on –&gt; on<br>Billy –&gt; billi<br>Bonds –&gt; bond<br>‘ –&gt; ‘<br>chest –&gt; chest<br>, –&gt; ,<br>but –&gt; but<br>the –&gt; the<br>exact –&gt; exact<br>copy –&gt; copi<br>of –&gt; of<br>everything –&gt; everyth<br>, –&gt; ,<br>name –&gt; name<br>and –&gt; and<br>height –&gt; height<br>and –&gt; and<br>sound –&gt; sound<br>, –&gt; ,<br>except –&gt; except<br>for –&gt; for<br>the –&gt; the<br>red –&gt; red<br>cross –&gt; cross<br>and –&gt; and<br>the –&gt; the<br>written –&gt; written<br>note –&gt; note<br>. –&gt; .</p>
<h2 id="3-2-Lemmatization-원형-추출"><a href="#3-2-Lemmatization-원형-추출" class="headerlink" title="3.2. Lemmatization (원형 추출)"></a>3.2. Lemmatization (원형 추출)</h2><ul>
<li>문장 속에서 다양한 형태로 활용된(inflected) 단어의 표제어(lemma)를 찾는 일</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> nltk.stem <span class="keyword">import</span> WordNetLemmatizer</span><br><span class="line">nltk.download(<span class="string">&#x27;wordnet&#x27;</span>)</span><br><span class="line"></span><br><span class="line">l = WordNetLemmatizer() </span><br><span class="line">words = [<span class="string">&#x27;doing&#x27;</span>, <span class="string">&#x27;has&#x27;</span>, <span class="string">&#x27;going&#x27;</span>, <span class="string">&#x27;loves&#x27;</span>, <span class="string">&#x27;lives&#x27;</span>, <span class="string">&#x27;flying&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> words:</span><br><span class="line">  lemma = l.lemmatize(i, pos=<span class="string">&#x27;v&#x27;</span>)</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;i&#125;</span> --&gt; <span class="subst">&#123;lemma&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>doing –&gt; do<br>has –&gt; have<br>going –&gt; go<br>loves –&gt; love<br>lives –&gt; live<br>flying –&gt; fly</p>
<h2 id="4-Edit-Distance"><a href="#4-Edit-Distance" class="headerlink" title="4. Edit Distance"></a>4. Edit Distance</h2><ul>
<li>2개의 문자열이 얼만큼 다른가를 거리개념으로 치환해 숫자로 표현한 것. 삽입, 삭제, 교체 연산이 존재함.</li>
<li>heat 과  hit 두단어의 차이는 2입니다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"><span class="keyword">from</span> nltk.metrics <span class="keyword">import</span> edit_distance</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(edit_distance(<span class="string">&quot;heat&quot;</span>,<span class="string">&quot;hit&quot;</span>))</span><br></pre></td></tr></table></figure>
<p>2</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://axa123-moon.github.io/2024/03/08/ROUGE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="axa123">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/03/08/ROUGE/" class="post-title-link" itemprop="url">ROUGE</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-03-08 09:18:42 / Modified: 10:20:25" itemprop="dateCreated datePublished" datetime="2024-03-08T09:18:42+09:00">2024-03-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ROUGE"><a href="#ROUGE" class="headerlink" title="ROUGE"></a>ROUGE</h1><ul>
<li>평가지표는 ROUGE(Recall-Oriented Understudy for Gisting Evaluation) 사용</li>
<li>텍스트 자동 요약, 기계 번역 등 자연어 생성 모델의 성능을 평가하기 위한 지표이며, 모델이 생성한 요약본 혹은 번역본을 사람이 미리 만들어 놓은 참조본과 대조해 성능 점수를 계산함</li>
</ul>
<p><img src="/images/Rouge/01.PNG"></p>
<h3 id="Recall과-Precesion"><a href="#Recall과-Precesion" class="headerlink" title="Recall과 Precesion"></a>Recall과 Precesion</h3><p><img src="/images/Rouge/02.PNG"></p>
<h3 id="ROUGE-1"><a href="#ROUGE-1" class="headerlink" title="ROUGE-1"></a>ROUGE-1</h3><ul>
<li>한 단어 기준으로 정답과 예측의 결과를 계산함</li>
</ul>
<p>정답 : <strong>the cat was under the bed</strong><br>예측 : <strong>the cat was</strong> found <strong>under the bed</strong></p>
<p><img src="/images/Rouge/03.PNG"></p>
<h3 id="ROUGE-2"><a href="#ROUGE-2" class="headerlink" title="ROUGE-2"></a>ROUGE-2</h3><ul>
<li>연속 두단어 기준으로 정답과 예측의 결과를 계산함</li>
</ul>
<p>정답 : <strong>[the cat]</strong> [cat was] [was under] <strong>[under the] [the bed]</strong><br>예측 : <strong>[under the] [the bed]</strong> [bed there] [there was] [was the] <strong>[the cat]</strong></p>
<p><img src="/images/Rouge/04.PNG"></p>
<h3 id="ROUGE-L"><a href="#ROUGE-L" class="headerlink" title="ROUGE-L"></a>ROUGE-L</h3><ul>
<li>가장 긴 공통부분 문자열의 길이를 기준으로 정답과 예측의 결과를 계산함</li>
</ul>
<p>정답 : the cat was <strong>under the bed</strong><br>예측 : <strong>under the bed</strong> there was the cat</p>
<p><img src="/images/Rouge/05.PNG"></p>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a target="_blank" rel="noopener" href="https://yumdata.tistory.com/435">https://yumdata.tistory.com/435</a><br><a target="_blank" rel="noopener" href="https://velog.io/@yoonene/ROUGE-Score%EB%9E%80">https://velog.io/@yoonene/ROUGE-Score%EB%9E%80</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://axa123-moon.github.io/2024/03/06/NLP-Pipeline/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="axa123">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/03/06/NLP-Pipeline/" class="post-title-link" itemprop="url">NLP Pipeline</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-03-06 18:20:41" itemprop="dateCreated datePublished" datetime="2024-03-06T18:20:41+09:00">2024-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-03-07 13:01:04" itemprop="dateModified" datetime="2024-03-07T13:01:04+09:00">2024-03-07</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Huggingface를-이용한-자연어-처리"><a href="#Huggingface를-이용한-자연어-처리" class="headerlink" title="Huggingface를 이용한 자연어 처리"></a>Huggingface를 이용한 자연어 처리</h1><h3 id="파이프라인-전체-구조"><a href="#파이프라인-전체-구조" class="headerlink" title="파이프라인 전체 구조"></a>파이프라인 전체 구조</h3><ol>
<li><strong>환경설정</strong><ul>
<li>라이브러리 설치 및 데이터셋 로드<br><br></li>
</ul>
</li>
<li><strong>데이터셋 구축</strong><ul>
<li>입력 데이터를 train과 valid로 나누고, 토크나이징 하여 torch dataset class로 변환</li>
<li>모델이 사용할 수 있는 데이터 구조로 변경함<br><br></li>
</ul>
</li>
<li><strong>모델 및 tokenizer 가져오기</strong><ul>
<li>Huggingface의 사전학습된 (Pre-trained) 모델 로드</li>
<li>사전학습된 모델과 tokenizer는 동일한 체크포인트(checkpoing)여야 학습가능함<br><br></li>
</ul>
</li>
<li><strong>모델 학습</strong><ul>
<li>Huggingface의 TrainingArguments 와 Trainer를 활용하여 학습데이터(train &#x2F; valid)로 모델 학습</li>
<li>Trainer를 사용하면 배치학습(Batch Learning), 학습 스케줄러(Learning Scheduler), 학습 조기종료(EarlyStopping)들의 기능을 간단히 사용할 수 있음<br><br></li>
</ul>
</li>
<li><strong>추론 및 평가</strong><ul>
<li>학습된 (Fine-tuned)모델을 통해 Test 데이터 추록 및 평가 진행<br><br></li>
</ul>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://axa123-moon.github.io/2024/03/04/Confusion-matrix/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="axa123">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/03/04/Confusion-matrix/" class="post-title-link" itemprop="url">Confusion matrix</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-03-04 17:07:29" itemprop="dateCreated datePublished" datetime="2024-03-04T17:07:29+09:00">2024-03-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-03-08 09:16:46" itemprop="dateModified" datetime="2024-03-08T09:16:46+09:00">2024-03-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Confusion-Matrix"><a href="#Confusion-Matrix" class="headerlink" title="Confusion Matrix"></a>Confusion Matrix</h1><ul>
<li>분류 모델의 성능을 평가하기 위해 실제 값과 모델이 예측한 값을 대조하는 표</li>
</ul>
<p><img src="/images/ConfusionMatrix/01.PNG"></p>
<pre><code>- TP : (모델이) 맞았다고 했는데(실제로) 맞은 것
- FN : (모델이) 틀렸다고 했는데 (실제로) 맞은 것
- FP : (모델이) 맞았다고 했는데 (실제로) 틀린 것
- TN : (모델이) 틀렸다고 했는데 (실제로) 틀린 것
</code></pre>
<h3 id="Accuracy-정확도"><a href="#Accuracy-정확도" class="headerlink" title="Accuracy(정확도)"></a>Accuracy(정확도)</h3><ul>
<li>(모델이) 예측한 것들 중에 (실제와) 일치한 것 비율<ul>
<li>TP+TN &#x2F; (TP+FP+FN+TN)</li>
</ul>
</li>
</ul>
<h3 id="Precision-정밀도"><a href="#Precision-정밀도" class="headerlink" title="Precision(정밀도)"></a>Precision(정밀도)</h3><ul>
<li>긍정으로 예측한 것 중 실제로 맞춘 비율<ul>
<li>TP &#x2F; (TP+FP)</li>
</ul>
</li>
</ul>
<h4 id="예시"><a href="#예시" class="headerlink" title="예시"></a>예시</h4><p><img src="/images/ConfusionMatrix/02.PNG"></p>
<h3 id="Recall-재현율"><a href="#Recall-재현율" class="headerlink" title="Recall(재현율)"></a>Recall(재현율)</h3><ul>
<li>(실제) 맞는 것들 중에 (모델이) 맞았다고 예측한 비율<ul>
<li>TP &#x2F; (TP + FN)</li>
</ul>
</li>
</ul>
<h4 id="예시-1"><a href="#예시-1" class="headerlink" title="예시"></a>예시</h4><p><img src="/images/ConfusionMatrix/03.PNG"></p>
<p><img src="/images/ConfusionMatrix/05.PNG"></p>
<h3 id="F1-score"><a href="#F1-score" class="headerlink" title="F1-score"></a>F1-score</h3><ul>
<li>Precision과 Recall 의 조화평균으로, 두가지 지표를 모두 고려하는 평가지표</li>
<li>불균형한 데이터에서 Accuracy 보다 효과적인 평가지표<ul>
<li>2 * (recall * precision) &#x2F; (recall + precision)</li>
</ul>
</li>
</ul>
<h4 id="예시-2"><a href="#예시-2" class="headerlink" title="예시"></a>예시</h4><p><img src="/images/ConfusionMatrix/04.PNG"></p>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a target="_blank" rel="noopener" href="https://yumdata.tistory.com/361">https://yumdata.tistory.com/361</a><br><a target="_blank" rel="noopener" href="https://dojinkimm.github.io/ml/2019/10/26/handson-ch3.html">https://dojinkimm.github.io/ml/2019/10/26/handson-ch3.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://axa123-moon.github.io/2024/02/26/CAM-Visualization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="axa123">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/02/26/CAM-Visualization/" class="post-title-link" itemprop="url">CAM Visualization</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-02-26 12:58:15 / Modified: 16:30:06" itemprop="dateCreated datePublished" datetime="2024-02-26T12:58:15+09:00">2024-02-26</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="모델별-시각화"><a href="#모델별-시각화" class="headerlink" title="모델별 시각화"></a>모델별 시각화</h1><ul>
<li>모델들에 대한 시각화하기</li>
<li>grad-cam 라이브러리를 이용한 CAM 시각화</li>
</ul>
<h3 id="Contents"><a href="#Contents" class="headerlink" title="Contents"></a>Contents</h3><ul>
<li>Library Import</li>
<li>Model 및 Image Load</li>
<li>Image Visualization</li>
<li>CAM Visualization</li>
</ul>
<h2 id="1-Library-Import"><a href="#1-Library-Import" class="headerlink" title="1. Library Import"></a>1. Library Import</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">warnings.simplefilter(<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"><span class="keyword">from</span> torchvision.models.segmentation <span class="keyword">import</span> deeplabv3_resnet50</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> pytorch_grad_cam.utils.image <span class="keyword">import</span> show_cam_on_image, preprocess_image</span><br></pre></td></tr></table></figure>

<h2 id="2-Model-및-image-Load"><a href="#2-Model-및-image-Load" class="headerlink" title="2. Model 및 image Load"></a>2. Model 및 image Load</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">image_url = <span class="string">&quot;https://farm1.staticflickr.com/6/9606553_ccc7518589_z.jpg&quot;</span></span><br><span class="line">image = np.array(Image.<span class="built_in">open</span>(requests.get(image_url, stream=<span class="literal">True</span>).raw))</span><br><span class="line">rgb_img = np.float32(image) / <span class="number">255</span></span><br><span class="line">input_tensor = preprocess_image(rgb_img,</span><br><span class="line">                                mean=[<span class="number">0.485</span>, <span class="number">0.456</span>, <span class="number">0.406</span>],</span><br><span class="line">                                std=[<span class="number">0.229</span>, <span class="number">0.224</span>, <span class="number">0.225</span>])</span><br><span class="line"><span class="comment"># Taken from the torchvision tutorial</span></span><br><span class="line"><span class="comment"># https://pytorch.org/vision/stable/auto_examples/plot_visualization_utils.html</span></span><br><span class="line">model = deeplabv3_resnet50(pretrained=<span class="literal">True</span>, progress=<span class="literal">False</span>)</span><br><span class="line">model = model.<span class="built_in">eval</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> torch.cuda.is_available():</span><br><span class="line">    model = model.cuda()</span><br><span class="line">    input_tensor = input_tensor.cuda()</span><br><span class="line"></span><br><span class="line">output = model(input_tensor)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(output), output.keys())</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SegmentationModelOutputWrapper</span>(torch.nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, model</span>): </span><br><span class="line">        <span class="built_in">super</span>(SegmentationModelOutputWrapper, self).__init__()</span><br><span class="line">        self.model = model</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="keyword">return</span> self.model(x)[<span class="string">&quot;out&quot;</span>]</span><br><span class="line">    </span><br><span class="line">model = SegmentationModelOutputWrapper(model)</span><br><span class="line">output = model(input_tensor)</span><br></pre></td></tr></table></figure>

<h2 id="3-Image-Visualization"><a href="#3-Image-Visualization" class="headerlink" title="3.  Image Visualization"></a>3.  Image Visualization</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">normalized_masks = torch.nn.functional.softmax(output, dim=<span class="number">1</span>).cpu()</span><br><span class="line">sem_classes = [</span><br><span class="line">    <span class="string">&#x27;__background__&#x27;</span>, <span class="string">&#x27;aeroplane&#x27;</span>, <span class="string">&#x27;bicycle&#x27;</span>, <span class="string">&#x27;bird&#x27;</span>, <span class="string">&#x27;boat&#x27;</span>, <span class="string">&#x27;bottle&#x27;</span>, <span class="string">&#x27;bus&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;car&#x27;</span>, <span class="string">&#x27;cat&#x27;</span>, <span class="string">&#x27;chair&#x27;</span>, <span class="string">&#x27;cow&#x27;</span>, <span class="string">&#x27;diningtable&#x27;</span>, <span class="string">&#x27;dog&#x27;</span>, <span class="string">&#x27;horse&#x27;</span>, <span class="string">&#x27;motorbike&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;person&#x27;</span>, <span class="string">&#x27;pottedplant&#x27;</span>, <span class="string">&#x27;sheep&#x27;</span>, <span class="string">&#x27;sofa&#x27;</span>, <span class="string">&#x27;train&#x27;</span>, <span class="string">&#x27;tvmonitor&#x27;</span></span><br><span class="line">]</span><br><span class="line">sem_class_to_idx = &#123;cls: idx <span class="keyword">for</span> (idx, cls) <span class="keyword">in</span> <span class="built_in">enumerate</span>(sem_classes)&#125;</span><br><span class="line"></span><br><span class="line">car_category = sem_class_to_idx[<span class="string">&quot;car&quot;</span>]</span><br><span class="line">car_mask = normalized_masks[<span class="number">0</span>, :, :, :].argmax(axis=<span class="number">0</span>).detach().cpu().numpy()</span><br><span class="line">car_mask_uint8 = <span class="number">255</span> * np.uint8(car_mask == car_category)</span><br><span class="line">car_mask_float = np.float32(car_mask == car_category)</span><br><span class="line"></span><br><span class="line">both_images = np.hstack((image, np.repeat(car_mask_uint8[:, :, <span class="literal">None</span>], <span class="number">3</span>, axis=-<span class="number">1</span>)))</span><br><span class="line">Image.fromarray(both_images)</span><br></pre></td></tr></table></figure>

<p><img src="/images/CAMVisualization/01.PNG"></p>
<h2 id="4-CAM-Visualization"><a href="#4-CAM-Visualization" class="headerlink" title="4.  CAM Visualization"></a>4.  CAM Visualization</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pytorch_grad_cam <span class="keyword">import</span> GradCAM</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SemanticSegmentationTarget</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, category, mask</span>):</span><br><span class="line">        self.category = category</span><br><span class="line">        self.mask = torch.from_numpy(mask)</span><br><span class="line">        <span class="keyword">if</span> torch.cuda.is_available():</span><br><span class="line">            self.mask = self.mask.cuda()</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, model_output</span>):</span><br><span class="line">        <span class="keyword">return</span> (model_output[self.category, :, : ] * self.mask).<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">target_layers = [model.model.backbone.layer4]</span><br><span class="line">targets = [SemanticSegmentationTarget(car_category, car_mask_float)]</span><br><span class="line"><span class="keyword">with</span> GradCAM(model=model,</span><br><span class="line">             target_layers=target_layers) <span class="keyword">as</span> cam:</span><br><span class="line">    grayscale_cam = cam(input_tensor=input_tensor,</span><br><span class="line">                        targets=targets)[<span class="number">0</span>, :]</span><br><span class="line">    cam_image = show_cam_on_image(rgb_img, grayscale_cam, use_rgb=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">Image.fromarray(cam_image)</span><br></pre></td></tr></table></figure>
<p><img src="/images/CAMVisualization/02.PNG"></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://jacobgil.github.io/pytorch-gradcam-book/introduction.html">https://jacobgil.github.io/pytorch-gradcam-book/introduction.html</a></li>
<li><a target="_blank" rel="noopener" href="https://csm-kr.tistory.com/74">https://csm-kr.tistory.com/74</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://axa123-moon.github.io/2024/02/23/CNN-layer-visualization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="axa123">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/02/23/CNN-layer-visualization/" class="post-title-link" itemprop="url">CNN layer visualization</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-02-23 16:38:47 / Modified: 18:05:43" itemprop="dateCreated datePublished" datetime="2024-02-23T16:38:47+09:00">2024-02-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="CNN-Layer별-시각화"><a href="#CNN-Layer별-시각화" class="headerlink" title="CNN Layer별 시각화"></a>CNN Layer별 시각화</h1><ul>
<li>CNN 각각의 레이어에서 Feature Map 내용 시각화 보기</li>
</ul>
<h3 id="Contents"><a href="#Contents" class="headerlink" title="Contents"></a>Contents</h3><ul>
<li>Library Import</li>
<li>Model Load</li>
<li>Image Load</li>
<li>Save Layer </li>
<li>Layer Visualization</li>
</ul>
<h2 id="1-Library-Import"><a href="#1-Library-Import" class="headerlink" title="1. Library Import"></a>1. Library Import</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> PIL </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">import</span> torchvision.transforms <span class="keyword">as</span> T</span><br><span class="line"></span><br><span class="line"><span class="comment"># seed 고정</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> torch.backends.cudnn <span class="keyword">as</span> cudnn</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">random_seed</span>(<span class="params">seed_num</span>):</span><br><span class="line">    torch.manual_seed(seed_num)</span><br><span class="line">    torch.cuda.manual_seed(seed_num)</span><br><span class="line">    torch.cuda.manual_seed_all(seed_num)</span><br><span class="line">    cudnn.benchmark = <span class="literal">False</span></span><br><span class="line">    cudnn.deterministic = <span class="literal">True</span></span><br><span class="line">    random.seed(seed_num)</span><br><span class="line"></span><br><span class="line">random_seed(<span class="number">2024</span>)</span><br></pre></td></tr></table></figure>

<h2 id="2-Model-Load"><a href="#2-Model-Load" class="headerlink" title="2. Model Load"></a>2. Model Load</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 원하는 모델을 torch.hub에서 불러옵니다</span></span><br><span class="line">model = torch.hub.load(<span class="string">&#x27;pytorch/vision&#x27;</span>, <span class="string">&#x27;resnet18&#x27;</span>, pretrained=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 가속 환경을 설정해 줍니다</span></span><br><span class="line">device = <span class="string">&#x27;cpu&#x27;</span></span><br><span class="line"><span class="keyword">if</span> torch.cuda.is_available():</span><br><span class="line">    device = <span class="string">&#x27;cuda&#x27;</span></span><br><span class="line">model = model.to(device)</span><br><span class="line"></span><br><span class="line"><span class="comment">#모델을 evaluation mode로 설정해 줍니다</span></span><br><span class="line">model.<span class="built_in">eval</span>()</span><br></pre></td></tr></table></figure>

<h2 id="3-Image-Load"><a href="#3-Image-Load" class="headerlink" title="3. Image Load"></a>3. Image Load</h2><ul>
<li>참고할만한 자료:</li>
</ul>
<ul>
<li><a target="_blank" rel="noopener" href="https://mmlab.ie.cuhk.edu.hk/projects/CelebA.html">CelebA 사이트</a></li>
<li><a target="_blank" rel="noopener" href="https://kr.freepik.com/free-photo/smiling-asian-young-woman-face-portrait_19009019.htm#query=%EC%82%AC%EB%9E%8C%20%EC%96%BC%EA%B5%B4&position=0&from_view=keyword&track=ais&uuid=4aa8a80d-cb2f-4cb1-8630-cc8bdbac6740%22%3E">출처 Freepik 작가 rawpixel.com</a></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">im = Image.<span class="built_in">open</span>(<span class="string">&quot;face3.jpg&quot;</span>)</span><br><span class="line">plt.imshow(im)</span><br></pre></td></tr></table></figure>

<p><img src="/images/CNNlLayerVisualization/01.PNG"></p>
<h2 id="4-Save-Layer"><a href="#4-Save-Layer" class="headerlink" title="4. Save Layer"></a>4. Save Layer</h2><ul>
<li>입력 이미지가 각 convolution layer를 거친 후의 output shape를 확인<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">preprocess = torchvision.transforms.Compose([</span><br><span class="line">    torchvision.transforms.Resize(<span class="number">256</span>),</span><br><span class="line">    torchvision.transforms.CenterCrop(<span class="number">224</span>),</span><br><span class="line">    torchvision.transforms.ToTensor(),</span><br><span class="line">    torchvision.transforms.Normalize(mean=[<span class="number">0.485</span>, <span class="number">0.456</span>, <span class="number">0.406</span>], std=[<span class="number">0.229</span>, <span class="number">0.224</span>, <span class="number">0.225</span>]),</span><br><span class="line">])</span><br><span class="line">im_tensor = preprocess(im)</span><br><span class="line">im_tensor = im_tensor.unsqueeze(<span class="number">0</span>).to(device) <span class="comment"># 이미지를 batch 형태로 바꾸어 줌</span></span><br><span class="line"><span class="comment">#print(im.size, im_tensor.shape)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 저장할 Convolution Layer를 list에 저장</span></span><br><span class="line">conv_layers = []</span><br><span class="line"></span><br><span class="line">model_children = <span class="built_in">list</span>(model.children())</span><br><span class="line"></span><br><span class="line">counter = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 모델을 구성하는 Layer들 중 nn.Conv2d 레이어들의 이름 저장</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(model_children)):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(model_children[i]) == nn.Conv2d:</span><br><span class="line">        counter+=<span class="number">1</span></span><br><span class="line">        conv_layers.append(model_children[i])</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">type</span>(model_children[i]) == nn.Sequential:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(model_children[i])):</span><br><span class="line">            <span class="keyword">for</span> child <span class="keyword">in</span> model_children[i][j].children():</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">type</span>(child) == nn.Conv2d:</span><br><span class="line">                    counter+=<span class="number">1</span></span><br><span class="line">                    conv_layers.append(child)</span><br><span class="line"><span class="comment">#print(f&quot;Total convolution layers: &#123;counter&#125;&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># conv_layer에 저장된 convolution layer를 거친 후의 결과를 outputs에 저장</span></span><br><span class="line"><span class="comment"># outputs에 저장된 결과는 해당 레이어를 거치고 난 다음의 Feature Map을 의미</span></span><br><span class="line">outputs = []</span><br><span class="line">names = []</span><br><span class="line">im_tensor_ = im_tensor</span><br><span class="line"><span class="keyword">for</span> i, layer <span class="keyword">in</span> <span class="built_in">enumerate</span>(conv_layers):</span><br><span class="line">    im_tensor_ = layer(im_tensor_)</span><br><span class="line">    outputs.append(im_tensor_)</span><br><span class="line">    names.append(<span class="built_in">str</span>(layer))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Convolution Layer들을 거치면서 Feature Map의 Shape이 어떻게 달라지는지 확인</span></span><br><span class="line"><span class="comment"># 4개의 conv layer마다 output의 channel 수는 2배가 되고 W,H는 각각 1/2이 됨</span></span><br><span class="line"><span class="keyword">for</span> i, feature_map <span class="keyword">in</span> <span class="built_in">enumerate</span>(outputs):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Output shape of conv-[<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>] layer: <span class="subst">&#123;<span class="built_in">tuple</span>(feature_map.shape)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/images/CNNlLayerVisualization/02.PNG"></p>
<h2 id="5-Layer-Visualization"><a href="#5-Layer-Visualization" class="headerlink" title="5. Layer Visualization"></a>5. Layer Visualization</h2><ul>
<li>convolution layer를 거친 output을 시각화하기</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 저장한 Feature Map을 시각화하기 위해 전처리</span></span><br><span class="line">processed = []</span><br><span class="line"><span class="keyword">for</span> feature_map <span class="keyword">in</span> outputs:</span><br><span class="line">    feature_map = feature_map.squeeze(<span class="number">0</span>)</span><br><span class="line">    gray_scale = torch.<span class="built_in">sum</span>(feature_map,<span class="number">0</span>)</span><br><span class="line">    gray_scale = gray_scale / feature_map.shape[<span class="number">0</span>]</span><br><span class="line">    processed.append(gray_scale.data.cpu().numpy())</span><br><span class="line"><span class="comment">#for fm in processed:</span></span><br><span class="line"><span class="comment">#    print(fm.shape)</span></span><br><span class="line">    </span><br><span class="line">fig = plt.figure(figsize=(<span class="number">30</span>, <span class="number">35</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(processed)):</span><br><span class="line">    a = fig.add_subplot(<span class="number">5</span>, <span class="number">4</span>, i+<span class="number">1</span>)</span><br><span class="line">    imgplot = plt.imshow(processed[i], cmap=<span class="string">&#x27;gray&#x27;</span>)</span><br><span class="line">    a.axis(<span class="string">&quot;off&quot;</span>)</span><br><span class="line">    a.set_title(names[i].split(<span class="string">&#x27;(&#x27;</span>)[<span class="number">0</span>]+<span class="string">&#x27;-[&#x27;</span>+<span class="built_in">str</span>(i+<span class="number">1</span>)+<span class="string">&#x27;]&#x27;</span>, fontsize=<span class="number">30</span>)</span><br><span class="line"><span class="comment">#plt.savefig(str(&#x27;feature_maps.jpg&#x27;), bbox_inches=&#x27;tight&#x27;)</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/CNNlLayerVisualization/04.PNG"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://axa123-moon.github.io/2024/02/20/%EB%AC%B8%EC%84%9C%ED%83%80%EC%9E%85%EB%B6%84%EB%A5%98%EB%8C%80%ED%9A%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="axa123">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/02/20/%EB%AC%B8%EC%84%9C%ED%83%80%EC%9E%85%EB%B6%84%EB%A5%98%EB%8C%80%ED%9A%8C/" class="post-title-link" itemprop="url">문서타입분류대회</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-02-20 17:46:21" itemprop="dateCreated datePublished" datetime="2024-02-20T17:46:21+09:00">2024-02-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-03-07 17:56:33" itemprop="dateModified" datetime="2024-03-07T17:56:33+09:00">2024-03-07</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="문서타입-분류대회"><a href="#문서타입-분류대회" class="headerlink" title="문서타입 분류대회"></a>문서타입 분류대회</h1><h2 id="1-Abstract"><a href="#1-Abstract" class="headerlink" title="1.Abstract"></a>1.Abstract</h2><h2 id="1-1-Goal-of-the-Competition"><a href="#1-1-Goal-of-the-Competition" class="headerlink" title="1.1 Goal of the Competition"></a>1.1 Goal of the Competition</h2><ul>
<li>17개 종의 문서를 분류</li>
</ul>
<h2 id="1-2-Timeline"><a href="#1-2-Timeline" class="headerlink" title="1.2 Timeline"></a>1.2 Timeline</h2><ul>
<li>2024.02.05 ~ 2024.02.19 19:00</li>
</ul>
<h2 id="1-3-Description-of-the-work"><a href="#1-3-Description-of-the-work" class="headerlink" title="1.3 Description of the work"></a>1.3 Description of the work</h2><ul>
<li>제공되는 1570장의 학습 이미지를 통해 3140장의 평가 이미지를 17개 종류의 문서로 예측</li>
<li>평가 이미지의 경우 실제 현실 세계의 데이터는 노이즈가 굉장히 많음 (구겨진 문서, 물에 젖은 문서, 빛번짐, …)</li>
</ul>
<h2 id="2-Process-Competition-Model"><a href="#2-Process-Competition-Model" class="headerlink" title="2. Process : Competition Model"></a>2. Process : Competition Model</h2><ul>
<li>첫 CV 대회를 참여하기에 가볍고 성능이 좋은 모델을 선택하였음. 타팀의 경우 성능 좋은 모델(MaxViT)을 사용하여서 더 좋은 점수를 얻는 경우를 확인하였음.<br>참조 : <a target="_blank" rel="noopener" href="https://paperswithcode.com/sota/image-classification-on-imagenet">https://paperswithcode.com/sota/image-classification-on-imagenet</a></li>
</ul>
<h4 id="efficientnet-b5-sw-in12k-ft-in1k"><a href="#efficientnet-b5-sw-in12k-ft-in1k" class="headerlink" title="efficientnet_b5.sw_in12k_ft_in1k"></a>efficientnet_b5.sw_in12k_ft_in1k</h4><ul>
<li>Model Type: Image classification &#x2F; feature backbone</li>
<li>Model Stats:</li>
<li>Params (M): 30.4</li>
<li>GMACs: 9.6</li>
<li>Activations (M): 93.6</li>
<li>Image size: 448 x 448</li>
</ul>
<h4 id="tf-efficientnet-b6-ns-jft-in1k"><a href="#tf-efficientnet-b6-ns-jft-in1k" class="headerlink" title="tf_efficientnet_b6.ns_jft_in1k"></a>tf_efficientnet_b6.ns_jft_in1k</h4><ul>
<li>Model Type: Image classification &#x2F; feature backbone</li>
<li>Model Stats:</li>
<li>Params (M): 43.0</li>
<li>GMACs: 19.4</li>
<li>Activations (M): 167.4</li>
<li>Image size: 528 x 528</li>
</ul>
<h4 id="tf-efficientnet-b7-ns-jft-in1k"><a href="#tf-efficientnet-b7-ns-jft-in1k" class="headerlink" title="tf_efficientnet_b7.ns_jft_in1k"></a>tf_efficientnet_b7.ns_jft_in1k</h4><ul>
<li>Model Type: Image classification &#x2F; feature backbone</li>
<li>Model Stats:</li>
<li>Params (M): 66.3</li>
<li>GMACs: 38.3</li>
<li>Activations (M): 289.9</li>
<li>Image size: 600 x 600</li>
</ul>
<h2 id="3-Process-Issues"><a href="#3-Process-Issues" class="headerlink" title="3. Process : Issues"></a>3. Process : Issues</h2><h2 id="3-1-Describe-the-issue-that-your-team-faced-during-the-project"><a href="#3-1-Describe-the-issue-that-your-team-faced-during-the-project" class="headerlink" title="3.1 Describe the issue that your team faced during the project."></a>3.1 Describe the issue that your team faced during the project.</h2><ul>
<li>한번도 cv 대회를 참여한 경험이 없어서 base code를 대회에 참여할 수 있는 코드로 확장하기 위하여 구글링하여 데이콘 경진대회 소스를 참조함.<ul>
<li>소스 참조 : <a target="_blank" rel="noopener" href="https://dacon.io/codeshare/3658">https://dacon.io/codeshare/3658</a></li>
</ul>
</li>
</ul>
<h2 id="3-2-Describe-the-possible-solution-to-imporve-your-project"><a href="#3-2-Describe-the-possible-solution-to-imporve-your-project" class="headerlink" title="3.2 Describe the possible solution to imporve your project"></a>3.2 Describe the possible solution to imporve your project</h2><h2 id="3-2-1-학습-이미지를-확장하기-위하여-offline-augmentation을-활용함"><a href="#3-2-1-학습-이미지를-확장하기-위하여-offline-augmentation을-활용함" class="headerlink" title="3.2.1 학습 이미지를 확장하기 위하여 offline augmentation을 활용함."></a>3.2.1 학습 이미지를 확장하기 위하여 offline augmentation을 활용함.</h2><ul>
<li>개인적으로 첫 경험이라 학습이미지를 1570장에서 8500장으로 생성하였으나, 타팀의 경우 50,000장 이상으로 확장하였음. 성능 향상에 진전이 있었음.</li>
<li>실제 테스트용 이미지를 확인하여 유사한 형태로 이미지를 만들어 내는 것이 중요하며, 학습이 되지 않는 문서을 경우 더 잘 확인해야 함.<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">make_aug_data</span>(<span class="params">df, repeat, interval, img_cnt</span>):</span><br><span class="line">    <span class="keyword">for</span> cat <span class="keyword">in</span> df[<span class="string">&#x27;target&#x27;</span>].unique():</span><br><span class="line">        <span class="comment"># cat.astype(str)</span></span><br><span class="line">        <span class="comment"># print(cat)</span></span><br><span class="line">        tgt_path = <span class="string">f&#x27;data/train/<span class="subst">&#123;cat&#125;</span>/&#x27;</span></span><br><span class="line">        org_path = <span class="string">f&#x27;data/train/&#x27;</span></span><br><span class="line">        os.makedirs(tgt_path, exist_ok=<span class="literal">True</span>)</span><br><span class="line">        <span class="built_in">print</span>(cat, org_path, org_path)</span><br><span class="line"></span><br><span class="line">        <span class="comment">#if cat != 3:</span></span><br><span class="line">        <span class="comment">#    continue</span></span><br><span class="line">        </span><br><span class="line">        new_img_cnt = img_cnt - df[df[<span class="string">&#x27;target&#x27;</span>]==cat].shape[<span class="number">0</span>]</span><br><span class="line">                    </span><br><span class="line">        idx = <span class="number">0</span></span><br><span class="line">        count = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> tqdm(df[df[<span class="string">&#x27;target&#x27;</span>]==cat][<span class="string">&#x27;ID&#x27;</span>]):</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(repeat):</span><br><span class="line">                idx += <span class="number">1</span></span><br><span class="line">                org_name = org_path + file</span><br><span class="line">                tgt_name = tgt_path + file</span><br><span class="line">                <span class="built_in">print</span>(cat, org_name, tgt_name, <span class="string">f&quot;<span class="subst">&#123;tgt_path&#125;</span><span class="subst">&#123;i&#125;</span>_<span class="subst">&#123;file&#125;</span>&quot;</span>)</span><br><span class="line">                image = cv2.imread(org_name)</span><br><span class="line"></span><br><span class="line">                train_augraphy = AugraphyPipeline([ShadowCast(shadow_opacity_range=(<span class="number">0</span>,<span class="number">0.35</span>)), LightingGradient(), LowLightNoise(p = <span class="number">0.5</span>)])</span><br><span class="line">                <span class="keyword">if</span> idx % interval == <span class="number">0</span>:</span><br><span class="line">                    image = train_augraphy(image)</span><br><span class="line"></span><br><span class="line">                aug = A.Compose([A.VerticalFlip(),</span><br><span class="line">                                A.Rotate(p=<span class="number">1</span>), </span><br><span class="line">                                A.HorizontalFlip(), </span><br><span class="line">                                A.RandomBrightnessContrast(brightness_limit=<span class="number">0.2</span>), </span><br><span class="line">                                A.OneOf([A.ShiftScaleRotate(shift_limit=<span class="number">0.1</span>, scale_limit=<span class="number">0.1</span>, rotate_limit=(<span class="number">15</span>, <span class="number">25</span>)),A.ShiftScaleRotate(shift_limit=<span class="number">0.1</span>, scale_limit=<span class="number">0.1</span>, rotate_limit=(-<span class="number">15</span>, -<span class="number">25</span>))], p=<span class="number">0.3</span>),</span><br><span class="line">                                A.GaussianBlur(always_apply=<span class="literal">False</span>, p=<span class="number">1.0</span>, blur_limit=(<span class="number">1</span>, <span class="number">9</span>), sigma_limit=(<span class="number">0</span>, <span class="number">6.91</span>)),</span><br><span class="line">                                A.PixelDropout(always_apply=<span class="literal">False</span>, p=<span class="number">1.0</span>, dropout_prob=<span class="number">0.1</span>, per_channel=<span class="number">0</span>, drop_value=(<span class="number">63</span>, <span class="number">195</span>, <span class="number">160</span>), mask_drop_value=<span class="literal">None</span>),</span><br><span class="line">                                <span class="comment">#A.AdvancedBlur(),</span></span><br><span class="line">                                <span class="comment">#A.ColorJitter(), # Ok</span></span><br><span class="line">                                <span class="comment">#A.GaussNoise(), # Ok</span></span><br><span class="line">                                <span class="comment">#A.OpticalDistortion(distort_limit=(-0.3, 0.3), shift_limit=0.5, p=0.5),</span></span><br><span class="line">                                <span class="comment">#A.Affine(scale=(0.9, 2), translate_percent=(-0.1, 0.1), rotate=(-10, 10), shear=(-20,20)),</span></span><br><span class="line">                                <span class="comment">#A.ElasticTransform(alpha=300), # 제외</span></span><br><span class="line">                                <span class="comment">#A.Resize(400,400)</span></span><br><span class="line">                                ]) <span class="comment"># (300,300)</span></span><br><span class="line"></span><br><span class="line">                image_aug = aug(image=image)[<span class="string">&#x27;image&#x27;</span>]</span><br><span class="line">                image_path = <span class="string">f&quot;<span class="subst">&#123;tgt_path&#125;</span><span class="subst">&#123;cat&#125;</span>_<span class="subst">&#123;i&#125;</span>_<span class="subst">&#123;file&#125;</span>&quot;</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(image_path):</span><br><span class="line">                    cv2.imwrite(image_path, image_aug)  <span class="comment">### augmentation 2번 시행할 때 &#x27;i&#x27;로 구분하지 않으면 덮어씌어짐</span></span><br><span class="line"></span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> count &gt; new_img_cnt:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">if</span> count &gt; new_img_cnt:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> os.path.exists(<span class="string">&#x27;data/train/1/&#x27;</span>) == <span class="literal">False</span>:</span><br><span class="line">    make_aug_data(train_df, <span class="number">10</span>, <span class="number">2</span>, <span class="number">500</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="3-2-2-학습-성능을-높이기-위하여-online-augmentation을-활용함"><a href="#3-2-2-학습-성능을-높이기-위하여-online-augmentation을-활용함" class="headerlink" title="3.2.2 학습 성능을 높이기 위하여 online augmentation을 활용함"></a>3.2.2 학습 성능을 높이기 위하여 online augmentation을 활용함</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># augmentation을 위한 transform 코드</span></span><br><span class="line">trn_transform = A.Compose([</span><br><span class="line">    <span class="comment"># Augmentation  추가</span></span><br><span class="line">    A.AdvancedBlur(),</span><br><span class="line">    A.ColorJitter(),</span><br><span class="line">    A.GaussNoise(),</span><br><span class="line">    A.OpticalDistortion(distort_limit=(-<span class="number">0.3</span>, <span class="number">0.3</span>), shift_limit=<span class="number">0.5</span>, p=<span class="number">0.5</span>),</span><br><span class="line">    A.Affine(scale=(<span class="number">0.9</span>, <span class="number">2</span>), translate_percent=(-<span class="number">0.1</span>, <span class="number">0.1</span>), rotate=(-<span class="number">10</span>, <span class="number">10</span>), shear=(-<span class="number">20</span>,<span class="number">20</span>)),</span><br><span class="line">    A.HorizontalFlip(),</span><br><span class="line">    A.ElasticTransform(alpha=<span class="number">300</span>), <span class="comment"># 제외함</span></span><br><span class="line">    <span class="comment">#A.Cutout(always_apply=True), # 추가 19:11, PB 점수가 0.8065에서 0.7699로 낮아짐</span></span><br><span class="line">    <span class="comment">#A.GaussianBlur(always_apply=False, p=1.0, blur_limit=(1, 11), sigma_limit=(0, 6.91)), # 추가 16:35</span></span><br><span class="line">    <span class="comment">#A.PixelDropout(always_apply=False, p=1.0, dropout_prob=0.1, per_channel=0, drop_value=(63, 195, 160), mask_drop_value=None), # 추가 16:35</span></span><br><span class="line">    <span class="comment"># 이미지 크기 조정</span></span><br><span class="line">    A.Resize(height=args.image_size, width=args.image_size),</span><br><span class="line">    <span class="comment"># images normalization</span></span><br><span class="line">    A.Normalize(mean=[<span class="number">0.485</span>, <span class="number">0.456</span>, <span class="number">0.406</span>], std=[<span class="number">0.229</span>, <span class="number">0.224</span>, <span class="number">0.225</span>]),</span><br><span class="line">    <span class="comment"># numpy 이미지나 PIL 이미지를 PyTorch 텐서로 변환</span></span><br><span class="line">    ToTensorV2(),</span><br><span class="line">])</span><br></pre></td></tr></table></figure>

<h2 id="3-2-3-학습-이미지-크기를-사용할-모델이-사전에-학습한-이미지-크기로-조정"><a href="#3-2-3-학습-이미지-크기를-사용할-모델이-사전에-학습한-이미지-크기로-조정" class="headerlink" title="3.2.3 학습 이미지 크기를 사용할 모델이 사전에 학습한 이미지 크기로 조정"></a>3.2.3 학습 이미지 크기를 사용할 모델이 사전에 학습한 이미지 크기로 조정</h2><ul>
<li>efficientnet_b5 Image size : 448 x 448</li>
<li>tf_efficientnet_b6  Image size: 528 x 528</li>
<li>tf_efficientnet_b7  Image size: 600 x 600</li>
</ul>
<h2 id="3-2-4-Batch-size-조정"><a href="#3-2-4-Batch-size-조정" class="headerlink" title="3.2.4 Batch size 조정"></a>3.2.4 Batch size 조정</h2><ul>
<li>시스템을 최대한 활용할 수 있도록 크기를 확장.</li>
<li>efficientnet_b5 Batch size : 16</li>
<li>tf_efficientnet_b6  Batch size: 16</li>
<li>tf_efficientnet_b7  Batch size: 8</li>
</ul>
<h2 id="3-2-5-Loss-함수-조정"><a href="#3-2-5-Loss-함수-조정" class="headerlink" title="3.2.5 Loss 함수 조정"></a>3.2.5 Loss 함수 조정</h2><ul>
<li>학습 진행에 따라서 적절한 loss 함수 사용이 필요함. 주로 CrossEntropyLoss를 사용하나 경우에 따라서는 focal loss를 사용할 수 있음. Loss함수에 대한 다양한 옵션 사용법을 알아 두어야 함</li>
</ul>
<h2 id="3-2-6-Optimizer-함수-조정"><a href="#3-2-6-Optimizer-함수-조정" class="headerlink" title="3.2.6 Optimizer 함수 조정"></a>3.2.6 Optimizer 함수 조정</h2><ul>
<li>학습 진행에 따라서 적절한optimizer 사용이 필요함. 주로 Adam을 사용하나 경우에 따라서는 변경할 수 있음. optimizer에 대한 다양한 옵션 사용법을 알아 두어야 함</li>
</ul>
<h2 id="3-2-7-learning-rate-조정"><a href="#3-2-7-learning-rate-조정" class="headerlink" title="3.2.7 learning rate 조정"></a>3.2.7 learning rate 조정</h2><ul>
<li>1e-4 ~ 1e-6으로 학습을 진행함.</li>
<li>GradScaler()를 사용하여 학습시 동적으로 learning rate 값을 조정할 수 있음</li>
</ul>
<h2 id="3-2-8-Early-stopping-조정"><a href="#3-2-8-Early-stopping-조정" class="headerlink" title="3.2.8 Early stopping 조정"></a>3.2.8 Early stopping 조정</h2><ul>
<li>학습시 patience는 15값 이상이 좋음. 15미만일 경우 성능 향상이 더 진행될 수 있는데 중단되는 경향이 있음</li>
</ul>
<h2 id="3-2-9-Epoch-조정"><a href="#3-2-9-Epoch-조정" class="headerlink" title="3.2.9 Epoch 조정"></a>3.2.9 Epoch 조정</h2><ul>
<li>반복 횟수는 30번 이상을 하는 것으로 성능 향상이 좋음. 타 팀의 경우 100회 이상을 하는 경우도 있음. Epoch 횟수가 높을 경우 Early stopping을 해주어야 불필요한 학습시간을 줄일 수 있음</li>
</ul>
<h2 id="3-2-10-학습-이미지-점검"><a href="#3-2-10-학습-이미지-점검" class="headerlink" title="3.2.10 학습 이미지 점검"></a>3.2.10 학습 이미지 점검</h2><ul>
<li>학습 이미지가 잘못 분류되어 있는지 점검이 필요함. 실제로 잘못분류되는 경우가 존재하였음</li>
</ul>
<h2 id="3-2-11-StratifiedKFold-적용"><a href="#3-2-11-StratifiedKFold-적용" class="headerlink" title="3.2.11 StratifiedKFold 적용"></a>3.2.11 StratifiedKFold 적용</h2><ul>
<li>주로 5 fold를 적용하며, 4 fold 적용시에도 성능이 좋게 나왔음</li>
</ul>
<h2 id="3-2-12-시각화를-통하여-예측확인"><a href="#3-2-12-시각화를-통하여-예측확인" class="headerlink" title="3.2.12 시각화를 통하여 예측확인"></a>3.2.12 시각화를 통하여 예측확인</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">plot_cm</span>(<span class="params">model_path, train_df, valid_df</span>):</span><br><span class="line">    torch.cuda.empty_cache()</span><br><span class="line">    gc.collect()</span><br><span class="line">    </span><br><span class="line">    train_data = ImageDataset3(<span class="string">&quot;data/train/&quot;</span>, </span><br><span class="line">                                train_df[<span class="string">&#x27;ID&#x27;</span>].values, </span><br><span class="line">                                train_df[<span class="string">&#x27;target&#x27;</span>].values, </span><br><span class="line">                                transform=trn_transform)</span><br><span class="line">    valid_data = ImageDataset3(<span class="string">&quot;data/train/&quot;</span>, </span><br><span class="line">                                    valid_df[<span class="string">&#x27;ID&#x27;</span>].values, </span><br><span class="line">                                    valid_df[<span class="string">&#x27;target&#x27;</span>].values, </span><br><span class="line">                                    transform=tst_transform)      </span><br><span class="line"></span><br><span class="line">    train_dataloader =  DataLoader(train_data,</span><br><span class="line">                          batch_size=args.batch_size,</span><br><span class="line">                          shuffle=<span class="literal">True</span>,</span><br><span class="line">                          num_workers=args.num_workers,</span><br><span class="line">                          pin_memory=<span class="literal">True</span>,    </span><br><span class="line">                          drop_last=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    valid_dataloader = DataLoader(valid_data,</span><br><span class="line">                            batch_size=args.batch_size,</span><br><span class="line">                            shuffle=<span class="literal">False</span>,</span><br><span class="line">                            num_workers=args.num_workers,</span><br><span class="line">                            pin_memory=<span class="literal">True</span>,</span><br><span class="line">                            drop_last=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    model = torch.load(model_path).to(config[<span class="string">&quot;device&quot;</span>])</span><br><span class="line">    model.<span class="built_in">eval</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">## train</span></span><br><span class="line">    y_pred = []</span><br><span class="line">    y_test = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> torch.no_grad(): <span class="comment"># model의 업데이트 막기    </span></span><br><span class="line">        pbar = tqdm(train_dataloader)</span><br><span class="line">        <span class="keyword">for</span> image, targets <span class="keyword">in</span> pbar:</span><br><span class="line">            image = image.to(device)</span><br><span class="line">            targets = targets.to(device)    </span><br><span class="line"></span><br><span class="line">            preds = model(image)</span><br><span class="line">            y_pred.extend(preds.argmax(dim=<span class="number">1</span>).detach().cpu().numpy())</span><br><span class="line">            y_test.extend(targets.detach().cpu().numpy())            </span><br><span class="line"></span><br><span class="line">    <span class="comment"># Creates a confusion matrix</span></span><br><span class="line">    cm = confusion_matrix(y_test, y_pred) </span><br><span class="line"></span><br><span class="line">    <span class="comment"># Transform to df for easier plotting</span></span><br><span class="line">    cm_df = pd.DataFrame(cm,</span><br><span class="line">                         index = [<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;7&#x27;</span>,<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;9&#x27;</span>,<span class="string">&#x27;10&#x27;</span>,<span class="string">&#x27;11&#x27;</span>,<span class="string">&#x27;12&#x27;</span>,<span class="string">&#x27;13&#x27;</span>,<span class="string">&#x27;14&#x27;</span>,<span class="string">&#x27;15&#x27;</span>,<span class="string">&#x27;16&#x27;</span>], </span><br><span class="line">                         columns = [<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;7&#x27;</span>,<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;9&#x27;</span>,<span class="string">&#x27;10&#x27;</span>,<span class="string">&#x27;11&#x27;</span>,<span class="string">&#x27;12&#x27;</span>,<span class="string">&#x27;13&#x27;</span>,<span class="string">&#x27;14&#x27;</span>,<span class="string">&#x27;15&#x27;</span>,<span class="string">&#x27;16&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    plt.figure(figsize=(<span class="number">8</span>,<span class="number">8</span>))</span><br><span class="line">    sns.heatmap(cm_df, annot=<span class="literal">True</span>, fmt=<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    plt.title(<span class="string">&#x27;Train Evaluate \nAccuracy:&#123;0:.3f&#125;&#x27;</span>.<span class="built_in">format</span>(accuracy_score(y_test, y_pred)))</span><br><span class="line">    plt.ylabel(<span class="string">&#x27;True label&#x27;</span>)</span><br><span class="line">    plt.xlabel(<span class="string">&#x27;Predicted label&#x27;</span>)</span><br><span class="line">    plt.show()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">## valid</span></span><br><span class="line">    y_pred = []</span><br><span class="line">    y_test = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">with</span> torch.no_grad(): <span class="comment"># model의 업데이트 막기    </span></span><br><span class="line">        pbar = tqdm(valid_dataloader)</span><br><span class="line">        <span class="keyword">for</span> image, targets <span class="keyword">in</span> pbar:</span><br><span class="line">            image = image.to(device)</span><br><span class="line">            targets = targets.to(device)    </span><br><span class="line"></span><br><span class="line">            preds = model(image)</span><br><span class="line">            y_pred.extend(preds.argmax(dim=<span class="number">1</span>).detach().cpu().numpy())</span><br><span class="line">            y_test.extend(targets.detach().cpu().numpy())  </span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Creates a confusion matrix</span></span><br><span class="line">    cm = confusion_matrix(y_test, y_pred) </span><br><span class="line"></span><br><span class="line">    <span class="comment"># Transform to df for easier plotting</span></span><br><span class="line">    cm_df = pd.DataFrame(cm,</span><br><span class="line">                         index = [<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;7&#x27;</span>,<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;9&#x27;</span>,<span class="string">&#x27;10&#x27;</span>,<span class="string">&#x27;11&#x27;</span>,<span class="string">&#x27;12&#x27;</span>,<span class="string">&#x27;13&#x27;</span>,<span class="string">&#x27;14&#x27;</span>,<span class="string">&#x27;15&#x27;</span>,<span class="string">&#x27;16&#x27;</span>], </span><br><span class="line">                         columns = [<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;7&#x27;</span>,<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;9&#x27;</span>,<span class="string">&#x27;10&#x27;</span>,<span class="string">&#x27;11&#x27;</span>,<span class="string">&#x27;12&#x27;</span>,<span class="string">&#x27;13&#x27;</span>,<span class="string">&#x27;14&#x27;</span>,<span class="string">&#x27;15&#x27;</span>,<span class="string">&#x27;16&#x27;</span>])</span><br><span class="line"></span><br><span class="line">    plt.figure(figsize=(<span class="number">8</span>,<span class="number">8</span>))</span><br><span class="line">    sns.heatmap(cm_df, annot=<span class="literal">True</span>, cmap=plt.cm.Blues, fmt=<span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">    plt.title(<span class="string">&#x27;Valid Evaluate \nAccuracy:&#123;0:.3f&#125;&#x27;</span>.<span class="built_in">format</span>(accuracy_score(y_test, y_pred)))</span><br><span class="line">    plt.ylabel(<span class="string">&#x27;True label&#x27;</span>)</span><br><span class="line">    plt.xlabel(<span class="string">&#x27;Predicted label&#x27;</span>)</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">visualize_training_results</span>(<span class="params">train_loss_array,</span></span><br><span class="line"><span class="params">                               val_loss_array,</span></span><br><span class="line"><span class="params">                               train_acc_array,</span></span><br><span class="line"><span class="params">                               val_acc_array,</span></span><br><span class="line"><span class="params">                               train_f1_array,</span></span><br><span class="line"><span class="params">                               val_f1_array,                               </span></span><br><span class="line"><span class="params">                               num_epochs,</span></span><br><span class="line"><span class="params">                               fold</span>):</span><br><span class="line">    fig, axs = plt.subplots(<span class="number">3</span>, <span class="number">1</span>, figsize=(<span class="number">12</span>,<span class="number">9</span>))</span><br><span class="line">    fig.suptitle(<span class="string">&quot;&#123;&#125; fold | &#123;&#125; training | Batch size: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(fold, args.model, args.batch_size), fontsize = <span class="number">16</span>)</span><br><span class="line">    axs[<span class="number">0</span>].plot(<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">1</span>, num_epochs+<span class="number">1</span>)), train_loss_array, label=<span class="string">&quot;train_loss&quot;</span>)</span><br><span class="line">    axs[<span class="number">0</span>].plot(<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">1</span>, num_epochs+<span class="number">1</span>)), val_loss_array, label=<span class="string">&quot;val_loss&quot;</span>)</span><br><span class="line">    axs[<span class="number">0</span>].legend(loc=<span class="string">&#x27;best&#x27;</span>)</span><br><span class="line">    axs[<span class="number">0</span>].<span class="built_in">set</span>(xlabel=<span class="string">&#x27;epochs&#x27;</span>, ylabel=<span class="string">&#x27;loss&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    axs[<span class="number">1</span>].plot(<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">1</span>, num_epochs+<span class="number">1</span>)), train_acc_array, label=<span class="string">&quot;train_acc&quot;</span>)</span><br><span class="line">    axs[<span class="number">1</span>].plot(<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">1</span>, num_epochs+<span class="number">1</span>)), val_acc_array, label=<span class="string">&quot;val_acc&quot;</span>)</span><br><span class="line">    axs[<span class="number">1</span>].legend(loc=<span class="string">&#x27;best&#x27;</span>)</span><br><span class="line">    axs[<span class="number">1</span>].<span class="built_in">set</span>(xlabel=<span class="string">&#x27;epochs&#x27;</span>, ylabel=<span class="string">&#x27;accuracy&#x27;</span>)    </span><br><span class="line"></span><br><span class="line">    axs[<span class="number">2</span>].plot(<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">1</span>, num_epochs+<span class="number">1</span>)), train_f1_array, label=<span class="string">&quot;train_f1&quot;</span>)</span><br><span class="line">    axs[<span class="number">2</span>].plot(<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">1</span>, num_epochs+<span class="number">1</span>)), val_f1_array, label=<span class="string">&quot;val_f1&quot;</span>)</span><br><span class="line">    axs[<span class="number">2</span>].legend(loc=<span class="string">&#x27;best&#x27;</span>)</span><br><span class="line">    axs[<span class="number">2</span>].<span class="built_in">set</span>(xlabel=<span class="string">&#x27;epochs&#x27;</span>, ylabel=<span class="string">&#x27;f1&#x27;</span>)    </span><br><span class="line">    plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/images/DocumentClassificationPrediction/04.PNG"><br><img src="/images/DocumentClassificationPrediction/05.PNG"><br><img src="/images/DocumentClassificationPrediction/06.PNG"></p>
<h2 id="4-Role"><a href="#4-Role" class="headerlink" title="4. Role"></a>4. Role</h2><ul>
<li>각자 본인들의 의견에 따라 모델 선정을 진행하고, 데이터 증강, 하이퍼파라메터를 조정하여 학습하였음</li>
</ul>
<h2 id="5-Result"><a href="#5-Result" class="headerlink" title="5. Result"></a>5. Result</h2><h3 id="5-1-학습-결과"><a href="#5-1-학습-결과" class="headerlink" title="5.1 학습 결과"></a>5.1 학습 결과</h3><p><img src="/images/DocumentClassificationPrediction/01.PNG"></p>
<h3 id="5-2-리더보드-결과"><a href="#5-2-리더보드-결과" class="headerlink" title="5.2 리더보드 결과"></a>5.2 리더보드 결과</h3><ul>
<li><p>리더보드 (대회진행)<br><img src="/images/DocumentClassificationPrediction/02.PNG"></p>
</li>
<li><p>리더보드 (최종)<br><img src="/images/DocumentClassificationPrediction/03.PNG"></p>
</li>
</ul>
<h2 id="6-Conclusion"><a href="#6-Conclusion" class="headerlink" title="6. Conclusion"></a>6. Conclusion</h2><ul>
<li>팀으로 진행하면서 각자 생각한 의견 및 분석 결과를 공유함으로 데이터를 이해하고, 모델 학습을 진행하는데 도움이 많이 되었음.</li>
<li>학습데이터를 증강함으로 인해서, 성능을 향상시키는 방법을 확인 하였음</li>
<li>최신 모델을 적용함으로 인해서, 성능을 향상시키는 방법을 확인 하였음</li>
<li>ML과 다른 하이퍼파라메터 튜닝을 진행하는 것을 배웠으며, 이 부분에 대한 학습이 필요함</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://axa123-moon.github.io/2024/01/31/%EC%95%84%ED%8C%8C%ED%8A%B8%EA%B0%80%EA%B2%A9%EC%98%88%EC%B8%A1%EB%8C%80%ED%9A%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="axa123">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/01/31/%EC%95%84%ED%8C%8C%ED%8A%B8%EA%B0%80%EA%B2%A9%EC%98%88%EC%B8%A1%EB%8C%80%ED%9A%8C/" class="post-title-link" itemprop="url">아파트가격예측대회</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-01-31 10:17:54 / Modified: 11:43:22" itemprop="dateCreated datePublished" datetime="2024-01-31T10:17:54+09:00">2024-01-31</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="아파트-가격-예측대회"><a href="#아파트-가격-예측대회" class="headerlink" title="아파트 가격 예측대회"></a>아파트 가격 예측대회</h1><h2 id="1-Abstract"><a href="#1-Abstract" class="headerlink" title="1.Abstract"></a>1.Abstract</h2><h2 id="1-1-Goal-of-the-Competition"><a href="#1-1-Goal-of-the-Competition" class="headerlink" title="1.1 Goal of the Competition"></a>1.1 Goal of the Competition</h2><ul>
<li>서울시 아파트 실거래가 매매 데이터를 기반으로 아파트 가격을 예측하는 대회</li>
</ul>
<h2 id="1-2-Timeline"><a href="#1-2-Timeline" class="headerlink" title="1.2 Timeline"></a>1.2 Timeline</h2><ul>
<li>2024.01.15 ~ 2024.01.25 19:00</li>
</ul>
<h2 id="1-3-Description-of-the-work"><a href="#1-3-Description-of-the-work" class="headerlink" title="1.3 Description of the work"></a>1.3 Description of the work</h2><ul>
<li>제공되는 4개의 데이터셋을 이용하여 모델을 학습하고, 서울시 각 지역의 아파트 매매 실거래가를 예측</li>
<li>데이터셋은 첫번째는 국토교통부에서 제공하는 아파트 실거래가 데이터로 아파트의 위치, 크기, 건축 연도, 주변 시설 및 교통 편의성과 같은 다양한 특징들을 포함하고 있습니다. 두번째와 세번째 데이터는 추가 데이터로, 서울시에서 제공하는 지하철역과 버스정류장에 대한 다양한 정보들을 포함하고 있습니다. 마지막 네번째 데이터는 평가 데이터로, 최종 모델성능에 대한 검증을 위해 사용됩니다.</li>
</ul>
<h2 id="2-Process-Competition-Model"><a href="#2-Process-Competition-Model" class="headerlink" title="2. Process : Competition Model"></a>2. Process : Competition Model</h2><h2 id="2-1-Contents"><a href="#2-1-Contents" class="headerlink" title="2.1 Contents"></a>2.1 Contents</h2><ul>
<li>Library Import</li>
<li>Data Load</li>
<li>Data Preprocessing</li>
<li>Feature Engineering</li>
<li>Model Training</li>
<li>Inference</li>
<li>Output File Save</li>
</ul>
<h2 id="2-2-Data-Load"><a href="#2-2-Data-Load" class="headerlink" title="2.2 Data Load"></a>2.2 Data Load</h2><h3 id="2-2-1-필요한-데이터를-load"><a href="#2-2-1-필요한-데이터를-load" class="headerlink" title="2.2.1 필요한 데이터를 load"></a>2.2.1 필요한 데이터를 load</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">train_path = <span class="string">&#x27;dataset/train.csv&#x27;</span></span><br><span class="line">test_path  = <span class="string">&#x27;dataset/test.csv&#x27;</span></span><br><span class="line">gps_path = <span class="string">&#x27;output/address_xy.csv&#x27;</span></span><br><span class="line">transport_path = <span class="string">&#x27;output/address_subway_bus.csv&#x27;</span></span><br><span class="line">landprice_path = <span class="string">&#x27;dataset/국토교통부_표준지공시지가_20230101.csv&#x27;</span></span><br><span class="line">buyindex_path = <span class="string">&#x27;output/apartment_region_index.csv&#x27;</span></span><br><span class="line">dt = pd.read_csv(train_path)</span><br><span class="line">dt_test = pd.read_csv(test_path)</span><br><span class="line">dt_gps = pd.read_csv(gps_path)</span><br><span class="line">dt_transport = pd.read_csv(transport_path)</span><br><span class="line">dt_landprice = pd.read_csv(landprice_path)</span><br><span class="line">dt_buyindex = pd.read_csv(buyindex_path, encoding=<span class="string">&#x27;EUC-KR&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="2-2-2-Dataset-Shape-확인"><a href="#2-2-2-Dataset-Shape-확인" class="headerlink" title="2.2.2 Dataset Shape 확인"></a>2.2.2 Dataset Shape 확인</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Train data shape : &#x27;</span>, dt.shape, <span class="string">&#x27;Test data shape : &#x27;</span>, dt_test.shape, <span class="string">&#x27;GPS data shape : &#x27;</span>, dt_gps.shape)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Transport data shape : &#x27;</span>, dt_transport.shape, <span class="string">&#x27;Land Price data shape : &#x27;</span>, dt_landprice.shape)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Buy index data shape : &#x27;</span>, dt_buyindex.shape)</span><br></pre></td></tr></table></figure>

<h3 id="2-2-3-Dataset-내용-확인"><a href="#2-2-3-Dataset-내용-확인" class="headerlink" title="2.2.3 Dataset 내용 확인"></a>2.2.3 Dataset 내용 확인</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">display(dt.head(<span class="number">1</span>))</span><br><span class="line">display(dt_test.head(<span class="number">1</span>))      <span class="comment"># 부동산 실거래가(=Target) column이 제외된 모습입니다.</span></span><br><span class="line">display(dt_gps.head(<span class="number">1</span>))</span><br><span class="line">display(dt_transport.head(<span class="number">1</span>))</span><br><span class="line">display(dt_landprice.head(<span class="number">1</span>))</span><br><span class="line">display(dt_buyindex.head(<span class="number">1</span>))</span><br></pre></td></tr></table></figure>

<h3 id="2-2-3-외부-데이터-합치기"><a href="#2-2-3-외부-데이터-합치기" class="headerlink" title="2.2.3 외부 데이터 합치기"></a>2.2.3 외부 데이터 합치기</h3><ul>
<li>GPS 좌표 합치기</li>
<li>주소기준 지하철 갯수, 버스정류장 갯수</li>
<li>아파트 매매 지수</li>
<li>표준지 공시지가</li>
</ul>
<h2 id="2-3-Data-Preprocessing"><a href="#2-3-Data-Preprocessing" class="headerlink" title="2.3 Data Preprocessing"></a>2.3 Data Preprocessing</h2><ul>
<li>모델링 전에 데이터 내 결측치, 이상치 등을 제거</li>
<li>범주형과 연속형 변수 확인</li>
</ul>
<h2 id="2-3-1-결측치-확인"><a href="#2-3-1-결측치-확인" class="headerlink" title="2.3.1 결측치 확인"></a>2.3.1 결측치 확인</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fig = plt.figure(figsize=(<span class="number">13</span>, <span class="number">2</span>))</span><br><span class="line">missing = concat.isnull().<span class="built_in">sum</span>() / concat.shape[<span class="number">0</span>]</span><br><span class="line">missing = missing[missing &gt; <span class="number">0</span>]</span><br><span class="line">missing.sort_values(inplace=<span class="literal">True</span>)</span><br><span class="line">missing.plot.bar(color=<span class="string">&#x27;orange&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;변수별 결측치 비율&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/images/ApartmentPricePrediction/01.PNG"></p>
<h2 id="2-3-2-결측치제거"><a href="#2-3-2-결측치제거" class="headerlink" title="2.3.2 결측치제거"></a>2.3.2 결측치제거</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 결측치가 1000000만개 이상인 feature 제외</span></span><br><span class="line">selected = <span class="built_in">list</span>(concat.columns[concat.isnull().<span class="built_in">sum</span>() &lt;= <span class="number">1000000</span>])</span><br><span class="line">concat_select = concat[selected]</span><br></pre></td></tr></table></figure>

<h2 id="2-3-3-연속형-변수와-범주형-변수-분리"><a href="#2-3-3-연속형-변수와-범주형-변수-분리" class="headerlink" title="2.3.3 연속형 변수와 범주형 변수 분리"></a>2.3.3 연속형 변수와 범주형 변수 분리</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">continuous_columns = []</span><br><span class="line">categorical_columns = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> column <span class="keyword">in</span> concat_select.columns:</span><br><span class="line">    <span class="keyword">if</span> pd.api.types.is_numeric_dtype(concat_select[column]):</span><br><span class="line">        continuous_columns.append(column)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        categorical_columns.append(column)</span><br></pre></td></tr></table></figure>

<h2 id="2-3-4-NULL-처리"><a href="#2-3-4-NULL-처리" class="headerlink" title="2.3.4 NULL 처리"></a>2.3.4 NULL 처리</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 범주형 변수에 대한 보간</span></span><br><span class="line">concat_select[categorical_columns] = concat_select[categorical_columns].fillna(<span class="string">&#x27;NULL&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 연속형 변수에 대한 보간 (선형 보간)</span></span><br><span class="line">concat_select[continuous_columns] = concat_select[continuous_columns].interpolate(method=<span class="string">&#x27;linear&#x27;</span>, axis=<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="2-3-5-이상치-처리"><a href="#2-3-5-이상치-처리" class="headerlink" title="2.3.5 이상치 처리"></a>2.3.5 이상치 처리</h2><ul>
<li>IQR(Inter Quartile Range)를 이용하여 Q1-1.5<em>IQR(하위 이상치) 및  Q1+1.5</em>IQR(상위 이상치) 제외</li>
</ul>
<h2 id="2-4-Feature-Engineering"><a href="#2-4-Feature-Engineering" class="headerlink" title="2.4 Feature Engineering"></a>2.4 Feature Engineering</h2><ul>
<li>파생변수 만들기</li>
<li>도메인 지식에 기반해서 만드는 것이 중요</li>
</ul>
<h2 id="2-4-1-강남구-유무-Feature-추가"><a href="#2-4-1-강남구-유무-Feature-추가" class="headerlink" title="2.4.1 강남구 유무 Feature 추가"></a>2.4.1 강남구 유무 Feature 추가</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">all</span> = <span class="built_in">list</span>(concat_select[<span class="string">&#x27;구&#x27;</span>].unique())</span><br><span class="line">gangnam = [<span class="string">&#x27;강서구&#x27;</span>, <span class="string">&#x27;영등포구&#x27;</span>, <span class="string">&#x27;동작구&#x27;</span>, <span class="string">&#x27;서초구&#x27;</span>, <span class="string">&#x27;강남구&#x27;</span>, <span class="string">&#x27;송파구&#x27;</span>, <span class="string">&#x27;강동구&#x27;</span>]</span><br><span class="line">gangbuk = [x <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">all</span> <span class="keyword">if</span> x <span class="keyword">not</span> <span class="keyword">in</span> gangnam]</span><br></pre></td></tr></table></figure>

<h2 id="2-4-2-신축-재건축-유무-Feature-추가"><a href="#2-4-2-신축-재건축-유무-Feature-추가" class="headerlink" title="2.4.2 신축&#x2F;재건축 유무 Feature 추가"></a>2.4.2 신축&#x2F;재건축 유무 Feature 추가</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">concat_select[<span class="string">&#x27;신축여부&#x27;</span>] = concat_select[<span class="string">&#x27;건축년도&#x27;</span>].apply(<span class="keyword">lambda</span> x: <span class="number">1</span> <span class="keyword">if</span> x &gt;= <span class="number">2009</span> <span class="keyword">else</span> <span class="number">0</span>)</span><br><span class="line">concat_select[<span class="string">&#x27;재건축&#x27;</span>] = concat_select[<span class="string">&#x27;건축년도&#x27;</span>].apply(<span class="keyword">lambda</span> x: <span class="number">1</span> <span class="keyword">if</span> x &lt; <span class="number">1990</span> <span class="keyword">else</span> <span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="2-4-3-거래량-Feature-추가"><a href="#2-4-3-거래량-Feature-추가" class="headerlink" title="2.4.3 거래량 Feature 추가"></a>2.4.3 거래량 Feature 추가</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">concat_select[<span class="string">&#x27;거래량_년월동&#x27;</span>] =  concat_select.groupby([<span class="string">&#x27;동&#x27;</span>,<span class="string">&#x27;계약년월&#x27;</span>])[<span class="string">&#x27;계약년월&#x27;</span>].transform(<span class="keyword">lambda</span> x: x.count())</span><br></pre></td></tr></table></figure>

<h2 id="2-4-4-최저가격-최대가격-비율-Feature-추가"><a href="#2-4-4-최저가격-최대가격-비율-Feature-추가" class="headerlink" title="2.4.4 최저가격&#x2F;최대가격&#x2F;비율 Feature 추가"></a>2.4.4 최저가격&#x2F;최대가격&#x2F;비율 Feature 추가</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">concat_select[<span class="string">&#x27;year_avg_price&#x27;</span>] = concat_select.groupby([<span class="string">&#x27;동&#x27;</span>, <span class="string">&#x27;아파트명&#x27;</span>, <span class="string">&#x27;전용면적&#x27;</span>,<span class="string">&#x27;year&#x27;</span>])[<span class="string">&#x27;target&#x27;</span>].transform(<span class="string">&#x27;mean&#x27;</span>)</span><br><span class="line">concat_select[<span class="string">&#x27;year_max_price&#x27;</span>] = concat_select.groupby([<span class="string">&#x27;동&#x27;</span>, <span class="string">&#x27;아파트명&#x27;</span>, <span class="string">&#x27;전용면적&#x27;</span>,<span class="string">&#x27;year&#x27;</span>])[<span class="string">&#x27;target&#x27;</span>].transform(<span class="string">&#x27;max&#x27;</span>)</span><br><span class="line">concat_select[<span class="string">&#x27;price_ratio&#x27;</span>] = (concat_select[<span class="string">&#x27;year_max_price&#x27;</span>] - concat_select[<span class="string">&#x27;year_avg_price&#x27;</span>]) / concat_select[<span class="string">&#x27;year_max_price&#x27;</span>]</span><br></pre></td></tr></table></figure>

<h2 id="2-4-5-Feature별-상관계수-확인"><a href="#2-4-5-Feature별-상관계수-확인" class="headerlink" title="2.4.5 Feature별 상관계수 확인"></a>2.4.5 Feature별 상관계수 확인</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 데이터의 상관계수 행렬을 생성</span></span><br><span class="line">corr = concat_select.corr(numeric_only=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># figure에서 생략될 부분을 지정하는 mask 행렬을 생성</span></span><br><span class="line">mask = np.ones_like(corr, dtype=<span class="built_in">bool</span>)</span><br><span class="line">mask = np.triu(mask)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 시각화될 그림의 크기를 지정</span></span><br><span class="line"><span class="comment"># 히트맵 형태로 상관행렬 시각화하기</span></span><br><span class="line">plt.figure(figsize=(<span class="number">13</span>,<span class="number">10</span>))</span><br><span class="line">sns.heatmap(data=corr, annot=<span class="literal">True</span>, fmt=<span class="string">&#x27;.2f&#x27;</span>, mask=mask, linewidths=<span class="number">.5</span>, cmap=<span class="string">&#x27;RdYlBu_r&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Correlation Matrix&#x27;</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p><img src="/images/ApartmentPricePrediction/02.PNG"></p>
<h2 id="2-4-6-중요도-낮은-Feature제거"><a href="#2-4-6-중요도-낮은-Feature제거" class="headerlink" title="2.4.6 중요도 낮은 Feature제거"></a>2.4.6 중요도 낮은 Feature제거</h2><ul>
<li>모델 생성 후 중요도가 낮은 Feature들 제거<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">drop_list = [<span class="string">&quot;k-단지분류&quot;</span>,<span class="string">&quot;k-전화번호&quot;</span>,<span class="string">&quot;k-팩스번호&quot;</span>, <span class="string">&quot;k-세대타입&quot;</span>, <span class="string">&quot;k-관리방식&quot;</span>,</span><br><span class="line">             <span class="string">&quot;k-복도유형&quot;</span>, <span class="string">&quot;k-난방방식&quot;</span>,<span class="string">&#x27;k-수정일자&#x27;</span>, <span class="string">&#x27;고용보험관리번호&#x27;</span>, <span class="string">&#x27;경비비관리형태&#x27;</span>, </span><br><span class="line">             <span class="string">&#x27;세대전기계약방법&#x27;</span>, <span class="string">&#x27;청소비관리형태&#x27;</span>, <span class="string">&quot;임대방식&quot;</span>,  <span class="string">&quot;단지승인일&quot;</span>, <span class="string">&quot;사용허가여부&quot;</span>, </span><br><span class="line">             <span class="string">&quot;관리비 업로드&quot;</span>, <span class="string">&quot;단지신청일&quot;</span>, <span class="string">&quot;좌표X&quot;</span>, <span class="string">&quot;좌표Y&quot;</span>, <span class="string">&quot;addr&quot;</span>, </span><br><span class="line">             <span class="string">&#x27;k-135㎡초과&#x27;</span>, <span class="string">&quot;등기신청일자&quot;</span>, <span class="string">&quot;거래유형&quot;</span>, <span class="string">&quot;중개사소재지&quot;</span>, <span class="string">&quot;k-건설사&quot;</span>, </span><br><span class="line">             <span class="string">&quot;k-시행사&quot;</span>, <span class="string">&quot;k-사용검사일-사용승인일&quot;</span>, <span class="string">&quot;k-홈페이지&quot;</span>, <span class="string">&quot;k-등록일자&quot;</span>,</span><br><span class="line">             <span class="string">&quot;계약년월일&quot;</span>, <span class="string">&quot;해제사유발생일&quot;</span>,</span><br><span class="line">             <span class="string">&quot;단지소개기존clob&quot;</span>, <span class="string">&#x27;본번&#x27;</span>, <span class="string">&#x27;부번&#x27;</span>,</span><br><span class="line">             <span class="string">&#x27;k-전용면적1&#x27;</span>, <span class="string">&#x27;k-전용면적2&#x27;</span>, <span class="string">&#x27;k-전용면적3&#x27;</span>, <span class="string">&#x27;k-관리비부과면적&#x27;</span></span><br><span class="line">             ]</span><br><span class="line"></span><br><span class="line">concat_select.drop(columns=drop_list, inplace=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="2-5-Model-Training"><a href="#2-5-Model-Training" class="headerlink" title="2.5 Model Training"></a>2.5 Model Training</h2><h2 id="2-5-1-범주형-변수-Encoding"><a href="#2-5-1-범주형-변수-Encoding" class="headerlink" title="2.5.1 범주형 변수 Encoding"></a>2.5.1 범주형 변수 Encoding</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 각 변수에 대한 LabelEncoder를 저장할 딕셔너리</span></span><br><span class="line">label_encoders = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Implement Label Encoding</span></span><br><span class="line"><span class="keyword">for</span> col <span class="keyword">in</span> tqdm( categorical_columns_v2 ):</span><br><span class="line">    lbl = LabelEncoder()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Label-Encoding을 fit</span></span><br><span class="line">    lbl.fit( dt_train[col].astype(<span class="built_in">str</span>) )</span><br><span class="line">    dt_train[col] = lbl.transform(dt_train[col].astype(<span class="built_in">str</span>))</span><br><span class="line">    label_encoders[col] = lbl </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> label <span class="keyword">in</span> np.unique(dt_test[col]):</span><br><span class="line">      <span class="keyword">if</span> label <span class="keyword">not</span> <span class="keyword">in</span> lbl.classes_: <span class="comment"># unseen label 데이터인 경우</span></span><br><span class="line">        lbl.classes_ = np.append(lbl.classes_, label)</span><br><span class="line"></span><br><span class="line">    dt_test[col] = lbl.transform(dt_test[col].astype(<span class="built_in">str</span>))</span><br><span class="line"></span><br><span class="line">dt_train.head(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/images/ApartmentPricePrediction/03.PNG"></p>
<h2 id="2-5-2-Model-Training"><a href="#2-5-2-Model-Training" class="headerlink" title="2.5.2 Model Training"></a>2.5.2 Model Training</h2><ul>
<li>Train과 Valid dataset을 분할하는 과정에서는 <code>holdout</code> 방법을 사용</li>
</ul>
<h2 id="2-5-2-1-학습-데이터와-검증-데이터-분리"><a href="#2-5-2-1-학습-데이터와-검증-데이터-분리" class="headerlink" title="2.5.2.1 학습 데이터와 검증 데이터 분리"></a>2.5.2.1 학습 데이터와 검증 데이터 분리</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">y_train = dt_train[<span class="string">&#x27;target&#x27;</span>]</span><br><span class="line">X_train = dt_train.drop([<span class="string">&#x27;target&#x27;</span>], axis=<span class="number">1</span>)</span><br><span class="line"><span class="comment"># 학습 데이터와 검증 데이터를 8:2 비율로 나눔</span></span><br><span class="line">X_train, X_val, y_train, y_val = train_test_split(X_train, y_train, test_size=<span class="number">0.2</span>, random_state=<span class="number">42</span>)</span><br></pre></td></tr></table></figure>

<h2 id="2-5-2-2-Optuna를-이용하여-학습"><a href="#2-5-2-2-Optuna를-이용하여-학습" class="headerlink" title="2.5.2.2 Optuna를 이용하여 학습"></a>2.5.2.2 Optuna를 이용하여 학습</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">optimizer</span>(<span class="params">trial</span>):</span><br><span class="line">    <span class="comment"># 조절할 hyper-parameter 조합을 적어줍니다.</span></span><br><span class="line">    num_leaves = trial.suggest_int(<span class="string">&#x27;num_leaves&#x27;</span>, <span class="number">30</span>, <span class="number">5000</span>) </span><br><span class="line">    max_depth =  trial.suggest_int(<span class="string">&#x27;max_depth&#x27;</span>, <span class="number">10</span>, <span class="number">30</span>) </span><br><span class="line">    learning_rate =  trial.suggest_float(<span class="string">&#x27;learning_rate&#x27;</span>, <span class="number">0.01</span>, <span class="number">0.1</span>) <span class="comment"># 최소값 : 5, 최대값 : 10</span></span><br><span class="line">    n_estimators =  trial.suggest_int(<span class="string">&#x27;n_estimators&#x27;</span>, <span class="number">100</span>, <span class="number">600</span>)</span><br><span class="line">    min_child_samples = trial.suggest_int(<span class="string">&#x27;min_child_samples&#x27;</span>, <span class="number">10</span>, <span class="number">50</span>)</span><br><span class="line">    reg_lambda =  trial.suggest_int(<span class="string">&#x27;reg_lambda&#x27;</span>, <span class="number">0.5</span>, <span class="number">100</span>)</span><br><span class="line">    colsample_bytree =  trial.suggest_float(<span class="string">&#x27;colsample_bytree&#x27;</span>, <span class="number">0.5</span>, <span class="number">0.8</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 원하는 모델을 지정합니다, optuna는 시간이 오래걸리기 때문에 저는 보통 RF로 일단 테스트를 해본 뒤에 LGBM을 사용합니다.</span></span><br><span class="line">    model = LGBMRegressor(</span><br><span class="line">                            num_leaves=num_leaves,</span><br><span class="line">                            max_depth=max_depth,</span><br><span class="line">                            learning_rate=learning_rate,</span><br><span class="line">                            n_estimators=n_estimators,</span><br><span class="line">                            min_child_samples=min_child_samples,</span><br><span class="line">                            reg_lambda=reg_lambda,</span><br><span class="line">                            colsample_bytree=colsample_bytree, <span class="comment"># 피쳐 갯수 * colsample_bytree</span></span><br><span class="line">                            random_state=<span class="number">42</span>,</span><br><span class="line">                            verbose=-<span class="number">1</span> <span class="comment"># 설정하지 않을 경우 경고 많이 나옴</span></span><br><span class="line">                            )</span><br><span class="line"></span><br><span class="line">    evaluation_metric = mean_squared_error</span><br><span class="line">    model.fit(X_train, y_train)</span><br><span class="line">    preds = model.predict(X_val)</span><br><span class="line">    score = evaluation_metric(y_val, preds)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> score</span><br><span class="line"></span><br><span class="line"><span class="comment"># 최소/최대 어느 방향의 최적값을 구할 건지.</span></span><br><span class="line"><span class="comment"># evaluation_metric이 mean_squared_error일 경우 낮을수록 좋으므로 minimize가 맞음</span></span><br><span class="line">study = optuna.create_study(direction=<span class="string">&quot;minimize&quot;</span>) </span><br><span class="line">study.optimize(optimizer, n_trials=<span class="number">10</span>)</span><br><span class="line">study.trials_dataframe()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Best Score: %.4f&quot;</span> % study.best_value) <span class="comment"># best score 출력</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Best params: &quot;</span>, study.best_trial.params) <span class="comment"># best score일 때의 하이퍼파라미터들</span></span><br></pre></td></tr></table></figure>
<h2 id="2-5-2-3-model-finalization"><a href="#2-5-2-3-model-finalization" class="headerlink" title="2.5.2.3 model finalization"></a>2.5.2.3 model finalization</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">best_params = study.best_params</span><br><span class="line"><span class="comment">#best_params = &#123;&#x27;num_leaves&#x27;: 3634, &#x27;max_depth&#x27;: 15, &#x27;learning_rate&#x27;: 0.09623189665884449, &#x27;n_estimators&#x27;: 496, &#x27;min_child_samples&#x27;: 13, &#x27;min_samples_leaf&#x27;: 9, &#x27;max_features&#x27;: 0.6099117970002513&#125;</span></span><br><span class="line">best_model = LGBMRegressor(**best_params,</span><br><span class="line">                        random_state=<span class="number">42</span>,</span><br><span class="line">                        verbose=-<span class="number">1</span>)</span><br><span class="line">evaluation_metric = mean_squared_error</span><br><span class="line">best_model.fit(X_train, y_train)</span><br><span class="line">preds = best_model.predict(X_val)</span><br><span class="line">score = evaluation_metric(y_val, preds)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Validation RMSE : %.4f&quot;</span> % np.sqrt(score))</span><br></pre></td></tr></table></figure>

<h2 id="2-5-2-4-변수-중요도-확인"><a href="#2-5-2-4-변수-중요도-확인" class="headerlink" title="2.5.2.4 변수 중요도 확인"></a>2.5.2.4 변수 중요도 확인</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">importances = pd.Series(best_model.feature_importances_, index=<span class="built_in">list</span>(X_train.columns))</span><br><span class="line">importances = importances.sort_values(ascending=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>,<span class="number">8</span>))</span><br><span class="line">plt.title(<span class="string">&quot;Feature Importances&quot;</span>)</span><br><span class="line">sns.barplot(x=importances, y=importances.index)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p><img src="/images/ApartmentPricePrediction/04.PNG"></p>
<h2 id="2-5-3-Feature-selection"><a href="#2-5-3-Feature-selection" class="headerlink" title="2.5.3 Feature selection"></a>2.5.3 Feature selection</h2><ul>
<li>어떤 변수가 유용한 변수인지 확인해보기</li>
</ul>
<h2 id="2-5-4-Valid-prediction-분석"><a href="#2-5-4-Valid-prediction-분석" class="headerlink" title="2.5.4. Valid prediction 분석"></a>2.5.4. Valid prediction 분석</h2><ul>
<li>예측이 잘 되었는지 확인</li>
</ul>
<h2 id="2-6-Inference"><a href="#2-6-Inference" class="headerlink" title="2.6 Inference"></a>2.6 Inference</h2><ul>
<li>테스트데이터를 이용한 예측값 도출<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pred = model.predict(X_test)</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="2-7-Output-File-Save"><a href="#2-7-Output-File-Save" class="headerlink" title="2.7 Output File Save"></a>2.7 Output File Save</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pred_df = pd.DataFrame(pred.astype(<span class="built_in">int</span>), columns=[<span class="string">&quot;target&quot;</span>])</span><br><span class="line">pred_df.to_csv(<span class="string">f&#x27;output/output_<span class="subst">&#123;filename&#125;</span>.csv&#x27;</span>, index=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<h2 id="3-Process-Issues"><a href="#3-Process-Issues" class="headerlink" title="3. Process : Issues"></a>3. Process : Issues</h2><ul>
<li>어떤 모델을 사용해야 할지에 대한 모델 선정에 대한 이슈가 있었으나, 여러 모델 (XGBoost, LSTM, RandomForest) 들 가운데서 LSTM이 가장 학습시간이 적게 소모되었으며 성능도 좋게 나왔음</li>
<li>Optuna를 이용하여 하이퍼파라메터를 튜닝하였으나, Local score와 Public score에 성능향상이 차이가 많이 존재하였음</li>
</ul>
<h2 id="4-Role"><a href="#4-Role" class="headerlink" title="4. Role"></a>4. Role</h2><ul>
<li>각자 본인들의 의견에 따라 Feature추가 및 모델 선정을 학습하였음</li>
<li>발표 자료 정리 및 발표 진행하였음</li>
</ul>
<h2 id="5-Result"><a href="#5-Result" class="headerlink" title="5. Result"></a>5. Result</h2><ul>
<li><p>리더보드 (대회진행)<br><img src="/images/ApartmentPricePrediction/05.PNG"></p>
</li>
<li><p>리더보드 (최종)<br><img src="/images/ApartmentPricePrediction/06.PNG"></p>
</li>
</ul>
<h2 id="6-Conclusion"><a href="#6-Conclusion" class="headerlink" title="6. Conclusion"></a>6. Conclusion</h2><ul>
<li>팀으로 진행하면서 각자 생각한 의견 및 분석 결과를 공유함으로 데이터를 이해하고, 모델 학습을 진행하는데 도움이 많이 되었음.</li>
<li>LGBM의 Default 하이퍼파라메터가 좋은 성능을 제공하여서, 경기 초반에는 하이퍼파라메터 튜닝보다는 Feature Engineering이 중요하다는 것을 알았음</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://axa123-moon.github.io/2024/01/30/DownloadFromUrl/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="axa123">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/01/30/DownloadFromUrl/" class="post-title-link" itemprop="url">DownloadFromUrl</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-01-30 15:33:18 / Modified: 15:36:42" itemprop="dateCreated datePublished" datetime="2024-01-30T15:33:18+09:00">2024-01-30</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Jupyter notebook에서 Url을 이용하여 다운로드하는 코드입니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> pathlib</span><br><span class="line"></span><br><span class="line">pathlib.Path(<span class="string">&quot;coco_imgs&quot;</span>).mkdir(parents=<span class="literal">True</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">urls = [</span><br><span class="line">    <span class="string">&#x27;http://images.cocodataset.org/val2014/COCO_val2014_000000000073.jpg&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://images.cocodataset.org/val2014/COCO_val2014_000000000285.jpg&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://images.cocodataset.org/val2014/COCO_val2014_000000000397.jpg&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://images.cocodataset.org/val2014/COCO_val2014_000000000827.jpg&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://images.cocodataset.org/val2014/COCO_val2014_000000001448.jpg&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://images.cocodataset.org/val2014/COCO_val2014_000000002753.jpg&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://images.cocodataset.org/val2014/COCO_val2014_000000006211.jpg&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://images.cocodataset.org/val2014/COCO_val2014_000000018893.jpg&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://images.cocodataset.org/val2014/COCO_val2014_000000038355.jpg&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://images.cocodataset.org/val2014/COCO_val2014_000000041276.jpg&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://images.cocodataset.org/val2014/COCO_val2014_000000050124.jpg&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;http://images.cocodataset.org/val2014/COCO_val2014_000000053503.jpg&#x27;</span>    </span><br><span class="line">]</span><br><span class="line"><span class="keyword">for</span> url <span class="keyword">in</span> urls:</span><br><span class="line"></span><br><span class="line">    filename = <span class="string">&#x27;./coco_imgs/&#x27;</span> + url.split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">    file = pathlib.Path(filename)</span><br><span class="line">    <span class="keyword">if</span> file.exists ():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;filename&#125;</span> is existed!&#x27;</span>)   </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        r = requests.get(url, allow_redirects=<span class="literal">True</span>)</span><br><span class="line">        <span class="built_in">open</span>(filename, <span class="string">&#x27;wb&#x27;</span>).write(r.content)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;filename&#125;</span> is downloaded!&#x27;</span>)   </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Download is completed!!!&#x27;</span>)    </span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">axa123</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
