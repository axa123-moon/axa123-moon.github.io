<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.0.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha256-CTSx/A06dm1B063156EVh15m6Y67pAjZZaQc89LLSrU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"axa123-moon.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.18.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="AI Beginner&#39;s Blog">
<meta property="og:url" content="https://axa123-moon.github.io/index.html">
<meta property="og:site_name" content="AI Beginner&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="axa123">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://axa123-moon.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"en","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>AI Beginner's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">AI Beginner's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>







</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">axa123</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">25</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">75</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://axa123-moon.github.io/2024/05/03/ORC%EB%8C%80%ED%9A%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="axa123">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/05/03/ORC%EB%8C%80%ED%9A%8C/" class="post-title-link" itemprop="url">ORC대회</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-05-03 10:25:04 / Modified: 11:41:31" itemprop="dateCreated datePublished" datetime="2024-05-03T10:25:04+09:00">2024-05-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="문자-인식-대회"><a href="#문자-인식-대회" class="headerlink" title="문자 인식 대회"></a>문자 인식 대회</h1><h2 id="1-Abstract"><a href="#1-Abstract" class="headerlink" title="1.Abstract"></a>1.Abstract</h2><h2 id="1-1-Goal-of-the-Competition"><a href="#1-1-Goal-of-the-Competition" class="headerlink" title="1.1 Goal of the Competition"></a>1.1 Goal of the Competition</h2><ul>
<li>인공지능 모델을 이용하여 제공된 영수증 이미지에서 문자의 위치를 정확하게 검출</li>
</ul>
<h2 id="1-2-Timeline"><a href="#1-2-Timeline" class="headerlink" title="1.2 Timeline"></a>1.2 Timeline</h2><ul>
<li>2024.04.08 ~ 2024.05.02 19:00</li>
</ul>
<h2 id="1-3-Description-of-the-work"><a href="#1-3-Description-of-the-work" class="headerlink" title="1.3 Description of the work"></a>1.3 Description of the work</h2><ul>
<li><p>제공되는 3273장의 train 이미지와 404개의 validation 이미지를 통해 413장의 test 이미지에서 문자의 위치를 예측</p>
</li>
<li><p>평가 이미지의 경우 실제 현실 세계의 노이즈가 존재함 (구겨짐, 글자번짐, 스탬프, 글자비침, 워터마크, 손글씨 등등)</p>
</li>
<li><p>각 이미지의 word box 정보 포함한 json 파일을 참조</p>
</li>
<li><p>원본이미지<br><img src="/images/OCRPrediction/05.PNG" alt="원본이미지"></p>
</li>
<li><p>원본이미지 (word box 적용)<br><img src="/images/OCRPrediction/06.PNG" alt="word box 적용 이미지"></p>
</li>
<li><p>json 구조<br><img src="/images/OCRPrediction/07.PNG" alt="json 구조"></p>
</li>
</ul>
<h2 id="2-Process-Competition-Model"><a href="#2-Process-Competition-Model" class="headerlink" title="2. Process : Competition Model"></a>2. Process : Competition Model</h2><ul>
<li>DBNET을 기반으로하여 다양한 encoder모델을 적용하였음. 또한 DBNET++ 구조도 적용함.</li>
</ul>
<p><img src="/images/OCRPrediction/01.PNG"></p>
<h4 id="resnet18-a2-in1k"><a href="#resnet18-a2-in1k" class="headerlink" title="resnet18.a2_in1k"></a>resnet18.a2_in1k</h4><ul>
<li>Model Type: Image classification &#x2F; feature backbone</li>
<li>Model Stats:</li>
<li>Params (M): 11.7</li>
<li>GMACs: 1.8</li>
<li>Activations (M): 2.5</li>
<li>Image size: 224 x 224</li>
</ul>
<h4 id="convnext-tiny-fb-in1k"><a href="#convnext-tiny-fb-in1k" class="headerlink" title="convnext_tiny.fb_in1k"></a>convnext_tiny.fb_in1k</h4><ul>
<li>Model Type: Image classification &#x2F; feature backbone</li>
<li>Model Stats:</li>
<li>Params (M): 28.6</li>
<li>GMACs: 4.5</li>
<li>Activations (M): 13.4</li>
<li>Image size: 224 x 224</li>
</ul>
<h4 id="efficientnet-b5-sw-in12k-ft-in1k"><a href="#efficientnet-b5-sw-in12k-ft-in1k" class="headerlink" title="efficientnet_b5.sw_in12k_ft_in1k"></a>efficientnet_b5.sw_in12k_ft_in1k</h4><ul>
<li>Model Type: Image classification &#x2F; feature backbone</li>
<li>Model Stats:</li>
<li>Params (M): 30.4</li>
<li>GMACs: 9.6</li>
<li>Activations (M): 93.6</li>
<li>Image size: 448 x 448</li>
</ul>
<h4 id="tf-efficientnetv2-m-in21k-ft-in1k"><a href="#tf-efficientnetv2-m-in21k-ft-in1k" class="headerlink" title="tf_efficientnetv2_m.in21k_ft_in1k"></a>tf_efficientnetv2_m.in21k_ft_in1k</h4><ul>
<li>Model Type: Image classification &#x2F; feature backbone</li>
<li>Model Stats:</li>
<li>Params (M): 54.1</li>
<li>GMACs: 15.9</li>
<li>Activations (M): 57.5</li>
<li>Image size: 384 x 384</li>
</ul>
<h2 id="3-Process-Issues"><a href="#3-Process-Issues" class="headerlink" title="3. Process : Issues"></a>3. Process : Issues</h2><h2 id="3-1-Describe-the-issue-that-your-team-faced-during-the-project"><a href="#3-1-Describe-the-issue-that-your-team-faced-during-the-project" class="headerlink" title="3.1 Describe the issue that your team faced during the project."></a>3.1 Describe the issue that your team faced during the project.</h2><ul>
<li>Base code가 pytorch lightenin과 hydra로 구성되어 있어서 분석하는데 시간이 필요하였음</li>
<li>hyperparameter로 성능 향상 후에 다양한 encoder모델을 적용하였으나, 성능 향상이 되지 않았음</li>
</ul>
<h2 id="3-2-Describe-the-possible-solution-to-imporve-your-project"><a href="#3-2-Describe-the-possible-solution-to-imporve-your-project" class="headerlink" title="3.2 Describe the possible solution to imporve your project"></a>3.2 Describe the possible solution to imporve your project</h2><h2 id="3-2-1-Backbone-모델-변경"><a href="#3-2-1-Backbone-모델-변경" class="headerlink" title="3.2.1 Backbone 모델 변경"></a>3.2.1 Backbone 모델 변경</h2><ul>
<li>DBNET 구조를 DBNET++ 구조로 변경하여 성능 향상 있었음 (<a target="_blank" rel="noopener" href="https://paperswithcode.com/paper/real-time-scene-text-detection-with-1">Adaptive Scale Fusion Module</a> 적용)</li>
</ul>
<h2 id="3-2-2-이미지-전처리"><a href="#3-2-2-이미지-전처리" class="headerlink" title="3.2.2 이미지 전처리"></a>3.2.2 이미지 전처리</h2><ul>
<li><a target="_blank" rel="noopener" href="http://www.google.co.kr/">Rembg</a> : 이미지에서 배경을 제거하는 라이브러리 적용 (성능향상 없음)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> rembg <span class="keyword">import</span> remove</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_images_with_rembg</span>(<span class="params">image_dir, json_path, output_image_dir</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">    - image_dir: 원본 이미지가 저장된 디렉토리 경로</span></span><br><span class="line"><span class="string">    - json_path: 이미지 메타데이터가 저장된 JSON 파일 경로</span></span><br><span class="line"><span class="string">    - output_image_dir: 배경이 제거된 이미지를 저장할 디렉토리 경로</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 출력 디렉토리가 존재하지 않는 경우 생성</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(output_image_dir):</span><br><span class="line">        os.makedirs(output_image_dir)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># JSON 파일 로드</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(json_path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = json.load(f)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 이미지 및 JSON 보정</span></span><br><span class="line">    <span class="keyword">for</span> image_file, image_data <span class="keyword">in</span> data[<span class="string">&quot;images&quot;</span>].items():</span><br><span class="line">        <span class="comment"># 이미지 파일 경로 생성</span></span><br><span class="line">        image_path = os.path.join(image_dir, image_file)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 이미지 로드 및 배경 제거</span></span><br><span class="line">        image = Image.<span class="built_in">open</span>(image_path).convert(<span class="string">&#x27;RGB&#x27;</span>)</span><br><span class="line">        output = remove(image)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 배경 제거된 이미지 저장</span></span><br><span class="line">        output_image_path = os.path.join(output_image_dir, image_file)</span><br><span class="line">        output_rgb = output.convert(<span class="string">&quot;RGB&quot;</span>)</span><br><span class="line">        output_rgb.save(output_image_path)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 함수 사용 예시</span></span><br><span class="line">image_dir = <span class="string">&#x27;/data/ephemeral/home/datasets/images/train/&#x27;</span></span><br><span class="line">json_path = <span class="string">&#x27;/data/ephemeral/home/datasets/jsons/train.json&#x27;</span></span><br><span class="line">output_image_dir = <span class="string">&#x27;/data/ephemeral/home/datasets/images/Rembg_train/&#x27;</span></span><br><span class="line">process_images_with_rembg(image_dir, json_path, output_image_dir)</span><br></pre></td></tr></table></figure>


<ul>
<li>이미지 crop : 배경 제거를 위해 gt의 최소점 x_min, y_min 과 최대점 x_max, y_max를 통해 crop_image의 w, h을 구한 뒤 10% 비율을 적용하여 image를 crop (성능향상 있음)</li>
</ul>
<h2 id="3-2-3-Train데이터-Word-box-보정"><a href="#3-2-3-Train데이터-Word-box-보정" class="headerlink" title="3.2.3 Train데이터 Word box 보정"></a>3.2.3 Train데이터 Word box 보정</h2><ul>
<li>아래 조건의 경우 word box를 제외함 (성능향상 없음)<br>(워터마크, 모자이크 된 곳에 word box가 있는 것, 빈 박스, 글자가 아닌 것(그림), 영수증 밖에 있는 word box, 손가락에 가려진 word box)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json </span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line"></span><br><span class="line">anns = &#123;&#125;</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/data/datasets/jsons/train.json&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    pred = json.load(f)</span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> pred[<span class="string">&#x27;images&#x27;</span>].keys():</span><br><span class="line">        <span class="comment"># Image file이 경로에 존재하는지 확인</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;words&#x27;</span> <span class="keyword">in</span> pred[<span class="string">&#x27;images&#x27;</span>][filename]:</span><br><span class="line">            <span class="comment"># Words의 Points 변환</span></span><br><span class="line">            gt_words = pred[<span class="string">&#x27;images&#x27;</span>][filename][<span class="string">&#x27;words&#x27;</span>]</span><br><span class="line">            polygons = [np.array([np.<span class="built_in">round</span>(word_data[<span class="string">&#x27;points&#x27;</span>])], dtype=np.int32)</span><br><span class="line">                        <span class="keyword">for</span> word_data <span class="keyword">in</span> gt_words.values()</span><br><span class="line">                        <span class="keyword">if</span> <span class="built_in">len</span>(word_data[<span class="string">&#x27;points&#x27;</span>])]</span><br><span class="line">            anns[filename] = polygons</span><br><span class="line"></span><br><span class="line">idx = <span class="number">1009</span> <span class="comment"># 영수증이미지 index</span></span><br><span class="line"></span><br><span class="line">index = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">10</span>,<span class="number">20</span>)) <span class="comment"># word box 10~19</span></span><br><span class="line">index = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">10</span>)) <span class="comment"># word box 0~9</span></span><br><span class="line"><span class="comment">#index = []</span></span><br><span class="line"></span><br><span class="line">index2 = [<span class="number">7</span>, <span class="number">8</span>, <span class="number">11</span>] <span class="comment"># 제외할 word box index</span></span><br><span class="line"></span><br><span class="line">index = index + index2</span><br><span class="line">root_path = <span class="string">&#x27;/data/ephemeral/home/datasets/images/train/&#x27;</span></span><br><span class="line">image_name = <span class="built_in">list</span>(anns.keys())[idx]</span><br><span class="line"><span class="comment"># image_name = &#x27;drp.en_ko.in_house.selectstar_000042.jpg&#x27;</span></span><br><span class="line">image_path = os.path.join(root_path, image_name)</span><br><span class="line">image_org = cv2.imread(image_path)</span><br><span class="line">image = image_org.copy()</span><br><span class="line">polygons = anns[image_name]</span><br><span class="line"><span class="built_in">print</span>(image_name)</span><br><span class="line"><span class="built_in">print</span>(idx)</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>, <span class="number">10</span>))</span><br><span class="line"><span class="keyword">for</span> i, box <span class="keyword">in</span> <span class="built_in">enumerate</span>(polygons[::-<span class="number">1</span>]):</span><br><span class="line">    <span class="keyword">if</span> i <span class="keyword">in</span> index:</span><br><span class="line">        <span class="comment">#print(box)</span></span><br><span class="line">        box = np.array(box).reshape(-<span class="number">1</span>, <span class="number">2</span>).astype(np.int32)</span><br><span class="line">        <span class="comment">#print(len(box))</span></span><br><span class="line">        x = box[<span class="number">0</span>][<span class="number">0</span>]</span><br><span class="line">        y = box[<span class="number">0</span>][<span class="number">1</span>] - <span class="number">10</span></span><br><span class="line">        <span class="keyword">if</span> y &lt; <span class="number">0</span>:</span><br><span class="line">            y = <span class="number">0</span></span><br><span class="line">        org = (x, y)</span><br><span class="line">        <span class="comment">#org = (50,50)</span></span><br><span class="line">        <span class="comment">#print(org)</span></span><br><span class="line">        fontFace = cv2.FONT_HERSHEY_SIMPLEX</span><br><span class="line">        fontScale = <span class="number">1</span></span><br><span class="line">        color = (<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">        thickness = <span class="number">2</span></span><br><span class="line">        lineType = cv2.LINE_AA</span><br><span class="line">        text = <span class="built_in">str</span>(i)</span><br><span class="line">        cv2.putText(image, text, org, fontFace, fontScale, color, thickness, lineType)</span><br><span class="line">        cv2.polylines(image, [box], <span class="literal">True</span>, (<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), thickness=<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        box = np.array(box).reshape(-<span class="number">1</span>, <span class="number">2</span>).astype(np.int32)</span><br><span class="line">        cv2.polylines(image, [box], <span class="literal">True</span>, (<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), thickness=<span class="number">2</span>)</span><br><span class="line">output = np.hstack((image_org, image))</span><br><span class="line">plt.imshow(output)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="/images/OCRPrediction/08.PNG"></p>
<h2 id="3-2-4-Hyperparameter-조정"><a href="#3-2-4-Hyperparameter-조정" class="headerlink" title="3.2.4 Hyperparameter 조정"></a>3.2.4 Hyperparameter 조정</h2><ul>
<li>use_polygon: True (성능 향상에 가장 큰 요소)</li>
<li>box_thresh: 0.47 (성능향상 있음)</li>
<li>thresh_map_loss_weight: 12.0 (성능향상 있음)</li>
<li>max_candidates: 500 (성능향상 있음)</li>
<li>negative_ratio: 3.5 (성능향상 있음)</li>
</ul>
<h2 id="4-Role"><a href="#4-Role" class="headerlink" title="4. Role"></a>4. Role</h2><ul>
<li>각자 본인들의 의견에 따라 모델 선정을 진행하고, 하이퍼파라메터를 조정하여 학습하였음</li>
<li>Train데이터 Word box 보정의 경우 시간이 많이 소요되어 배분하여 작업 진행</li>
</ul>
<h2 id="5-Result"><a href="#5-Result" class="headerlink" title="5. Result"></a>5. Result</h2><h3 id="5-1-학습-결과"><a href="#5-1-학습-결과" class="headerlink" title="5.1 학습 결과"></a>5.1 학습 결과</h3><p><img src="/images/OCRPrediction/02.PNG"></p>
<h3 id="5-2-리더보드-결과"><a href="#5-2-리더보드-결과" class="headerlink" title="5.2 리더보드 결과"></a>5.2 리더보드 결과</h3><ul>
<li><p>리더보드 (대회진행)<br><img src="/images/OCRPrediction/03.PNG"></p>
</li>
<li><p>리더보드 (최종)<br><img src="/images/OCRPrediction/04.PNG"></p>
</li>
</ul>
<h2 id="6-Conclusion"><a href="#6-Conclusion" class="headerlink" title="6. Conclusion"></a>6. Conclusion</h2><ul>
<li>팀으로 진행하면서 각자 생각한 의견 및 분석 결과를 공유함으로 데이터를 이해하고, 모델 학습을 진행하는데 도움이 많이 되었음.</li>
<li>다양한 Hyperparmeter를 조정함으로 성능을 향상시키는 방법을 확인 하였음</li>
<li>이미지 데이터를 전처리 함으로 성능을 향상시키는 방법을 확인 하였음</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://axa123-moon.github.io/2024/04/03/OpenAI-function-calling/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="axa123">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/03/OpenAI-function-calling/" class="post-title-link" itemprop="url">OpenAI function calling</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-04-03 13:04:09 / Modified: 13:12:08" itemprop="dateCreated datePublished" datetime="2024-04-03T13:04:09+09:00">2024-04-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="OPENAI-function-calling"><a href="#OPENAI-function-calling" class="headerlink" title="OPENAI function calling"></a>OPENAI function calling</h1><ul>
<li>function calling을 이용하여 Openai API 사용하기</li>
<li>API Key 링크 : <a target="_blank" rel="noopener" href="https://platform.openai.com/api-keys">https://platform.openai.com/api-keys</a></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># OpenAI 라이브러리 및 필요한 모듈</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> OpenAI</span><br><span class="line"></span><br><span class="line"><span class="comment"># OpenAI API KEY 환경변수 설정</span></span><br><span class="line">os.environ[<span class="string">&quot;OPENAI_API_KEY&quot;</span>] = <span class="string">&quot;xxxxxxxxxxxx&quot;</span></span><br><span class="line"><span class="comment">#os.environ[&quot;OPENAI_API_KEY&quot;] = &quot;Your API Key&quot;</span></span><br><span class="line"></span><br><span class="line">client = OpenAI()</span><br><span class="line"><span class="comment"># 사용할 모델을 설정</span></span><br><span class="line">model = <span class="string">&quot;gpt-3.5-turbo-1106&quot;</span></span><br><span class="line"></span><br><span class="line">prompt_json = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">### Role: 여행지 검색 도우미 ###</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Instruction ###</span></span><br><span class="line"><span class="string">- 사용자의 요청이 여행지 추천이나 검색인 경우에는 질의 분석 결과를 생성한다.</span></span><br><span class="line"><span class="string">- 질의 분석 결과에 대해서는 지금까지 주고받은 전체 사용자 메시지를 분석하여 검색에 사용하기 적합한 최종 질의, 지역, 여행장소 종류를 포함하여 아래와 같이 JSON 형태로 출력한다.</span></span><br><span class="line"><span class="string">- 여행지 추천이나 검색이 아닌 나머지 질의는 적절한 대답을 생성한다.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Output ###</span></span><br><span class="line"><span class="string">&#123;&quot;query&quot;: $query, &quot;location&quot;: $location, &quot;place&quot;: $place&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">prompt_fc = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">### Name: Helper ###</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Role: 여행지 검색 도우미 ###</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Instruction ###</span></span><br><span class="line"><span class="string">- 사용자의 요청이 여행지 추천이나 검색인 경우에는 질의 분석 결과를 생성한다.</span></span><br><span class="line"><span class="string">- 질의 분석 결과에 대해서는 지금까지 주고받은 전체 사용자 메시지를 분석하여 검색에 사용하기 적합한 최종 질의, 지역, 여행장소를 function calling 결과에 포함하여 출력한다.</span></span><br><span class="line"><span class="string">- 여행지 추천이나 검색이 아닌 나머지 질의는 적절한 대답을 생성한다.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">tools = [</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span>,</span><br><span class="line">        <span class="string">&quot;function&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;search_place&quot;</span>,</span><br><span class="line">            <span class="string">&quot;description&quot;</span>: <span class="string">&quot;여행지을 검색한다.&quot;</span>,</span><br><span class="line">            <span class="string">&quot;parameters&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;기존 메시지 히스토리를 감안한 검색에 사용하기 적합한 최종 질의&quot;</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">&quot;location&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;제주도, 울릉도, 백령도 &quot;</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">&quot;place&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;관광장소&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;enum&quot;</span>: [<span class="string">&quot;협재해수욕장&quot;</span>, <span class="string">&quot;월정리해변&quot;</span>, <span class="string">&quot;주상절리대&quot;</span>, <span class="string">&quot;독도&quot;</span>, <span class="string">&quot;울릉해안도로&quot;</span>, <span class="string">&quot;울릉도 둘레길&quot;</span>, <span class="string">&quot;토끼섬&quot;</span>]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;required&quot;</span>: [<span class="string">&quot;query&quot;</span>, <span class="string">&quot;location&quot;</span>, <span class="string">&quot;place&quot;</span>],</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span>,</span><br><span class="line">        <span class="string">&quot;function&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;name&quot;</span>: <span class="string">&quot;restarant_place&quot;</span>,</span><br><span class="line">            <span class="string">&quot;description&quot;</span>: <span class="string">&quot;식당 정보 제공&quot;</span>,</span><br><span class="line">            <span class="string">&quot;parameters&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;place_name&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;식당&quot;</span>,</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="string">&quot;question&quot;</span>: &#123;</span><br><span class="line">                        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;description&quot;</span>: <span class="string">&quot;상세 정보 요청을 위한 질문&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;required&quot;</span>: [<span class="string">&quot;place_name&quot;</span>, <span class="string">&quot;question&quot;</span>],</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">messages = [</span><br><span class="line">&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;너는 누구니&quot;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;저는 여행 검색 도우미 Helper 라고 합니다.&quot;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;제주도 여행지 추천해줘&quot;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;제주도 여행지 협재해수욕장, 월정리해변, 주상절리대 추천합니다.&quot;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;울릉도 여행지로 알아봐줘&quot;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;울릉도에는 독도, 울릉해안도로, 울릉도 둘레길이 있습니다.&quot;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;아니다 백령도 여행지를 추천해줘&quot;</span>&#125; <span class="comment"># implicit instruction</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 일반 요청</span></span><br><span class="line">get_tour_info(messages, prompt_json)</span><br></pre></td></tr></table></figure>

<p>ChatCompletionMessage(content&#x3D;’{“query”: “백령도 여행지”, “location”: “백령도”, “place”: “관음사, 백령도등대, 백령도해수욕장”}’, role&#x3D;’assistant’, function_call&#x3D;None, tool_calls&#x3D;None)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># JSON mode 요청</span></span><br><span class="line">get_tour_info(messages, prompt_json, &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;json_object&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>

<p>ChatCompletionMessage(content&#x3D;’{“query”: “백령도 여행지”, “location”: “백령도”, “place”: “관음사, 백령도등대, 백령도 자연휴양림”}’, role&#x3D;’assistant’, function_call&#x3D;None, tool_calls&#x3D;None)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Function calling 사용</span></span><br><span class="line">get_tour_info_fc(messages, prompt_fc, tools)</span><br></pre></td></tr></table></figure>

<p>ChatCompletionMessage(content&#x3D;None, role&#x3D;’assistant’, function_call&#x3D;None, tool_calls&#x3D;[ChatCompletionMessageToolCall(id&#x3D;’call_azrNU8uemmGPae5ySlSO3SlP’, function&#x3D;Function(arguments&#x3D;’{“query”:”백령도 여행지”,”location”:”백령도”,”place”:”토끼섬”}’, name&#x3D;’search_place’), type&#x3D;’function’)])</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Function calling 사용때 사용할 function 명시</span></span><br><span class="line">get_tour_info_fc(messages, prompt_fc, tools, &#123;<span class="string">&quot;type&quot;</span>: <span class="string">&quot;function&quot;</span>, <span class="string">&quot;function&quot;</span>: &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;search_place&quot;</span>&#125;&#125;)</span><br></pre></td></tr></table></figure>

<p>ChatCompletionMessage(content&#x3D;None, role&#x3D;’assistant’, function_call&#x3D;None, tool_calls&#x3D;[ChatCompletionMessageToolCall(id&#x3D;’call_1XVBFMrPwoObzQr7PgEFGPei’, function&#x3D;Function(arguments&#x3D;’{“query”:”백령도 여행지”,”location”:”백령도”,”place”:”토끼섬”}’, name&#x3D;’search_place’), type&#x3D;’function’)])</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">messages = [</span><br><span class="line">&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;너는 누구니&quot;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;assistant&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;저는 여행지 검색 도우미 Helper 라고 합니다.&quot;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="string">&quot;제주도 맛집 추천해줘&quot;</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Function calling을 통해 원하는 function이 선택되는지 확인</span></span><br><span class="line">get_tour_info_fc(messages, prompt_fc, tools)</span><br></pre></td></tr></table></figure>

<p>ChatCompletionMessage(content&#x3D;None, role&#x3D;’assistant’, function_call&#x3D;None, tool_calls&#x3D;[ChatCompletionMessageToolCall(id&#x3D;’call_DkvSCy7JEy7en3rZfxmM2Dem’, function&#x3D;Function(arguments&#x3D;’{“place_name”:”제주도”,”question”:”제주도 맛집을 추천해드릴까요?”}’, name&#x3D;’restarant_place’), type&#x3D;’function’)])</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://axa123-moon.github.io/2024/04/03/OpenAI-JSON-Mode/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="axa123">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/03/OpenAI-JSON-Mode/" class="post-title-link" itemprop="url">OpenAI JSON Mode</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-04-03 11:00:33 / Modified: 11:34:20" itemprop="dateCreated datePublished" datetime="2024-04-03T11:00:33+09:00">2024-04-03</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="OPENAI-JSON-Mode"><a href="#OPENAI-JSON-Mode" class="headerlink" title="OPENAI JSON Mode"></a>OPENAI JSON Mode</h1><ul>
<li>JSON mode 설정시 JSON Format으로 출력 결과를 받아낼 수 있음</li>
<li>API Key 링크 : <a target="_blank" rel="noopener" href="https://platform.openai.com/api-keys">https://platform.openai.com/api-keys</a></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># OpenAI 라이브러리 및 필요한 모듈</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> openai <span class="keyword">import</span> OpenAI</span><br><span class="line"></span><br><span class="line"><span class="comment"># OpenAI API KEY 환경변수 설정</span></span><br><span class="line">os.environ[<span class="string">&quot;OPENAI_API_KEY&quot;</span>] = <span class="string">&quot;xxxxxxxxxxxx&quot;</span></span><br><span class="line"><span class="comment">#os.environ[&quot;OPENAI_API_KEY&quot;] = &quot;Your API Key&quot;</span></span><br><span class="line"></span><br><span class="line">client = OpenAI()</span><br><span class="line"><span class="comment"># 사용할 모델을 설정</span></span><br><span class="line">model = <span class="string">&quot;gpt-3.5-turbo-1106&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 각 문장에 대해 openai API를 수행하는 함수를 정의</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sentiment</span>(<span class="params"><span class="keyword">case</span>, persona, response_format=<span class="literal">None</span></span>):</span><br><span class="line">    messages = [</span><br><span class="line">        &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;system&quot;</span>, <span class="string">&quot;content&quot;</span>: persona&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;role&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;content&quot;</span>: <span class="keyword">case</span>&#125;</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Test case: <span class="subst">&#123;<span class="keyword">case</span>&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># response_format이 지정되었으면 해당 형식으로 결과를 반환</span></span><br><span class="line">    <span class="keyword">if</span> response_format:</span><br><span class="line">        result = client.chat.completions.create(</span><br><span class="line">            model=model,</span><br><span class="line">            messages=messages,</span><br><span class="line">            temperature=<span class="number">0.1</span>,</span><br><span class="line">            timeout=<span class="number">10</span>,</span><br><span class="line">            response_format=response_format,</span><br><span class="line">            seed=<span class="number">1</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result = client.chat.completions.create(</span><br><span class="line">            model=model,</span><br><span class="line">            messages=messages,</span><br><span class="line">            temperature=<span class="number">0.1</span>,</span><br><span class="line">            timeout=<span class="number">10</span>,</span><br><span class="line">            seed=<span class="number">1</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;Result: \n<span class="subst">&#123;result.choices[<span class="number">0</span>].message.content&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 테스트 할 문장</span></span><br><span class="line">sentences = [</span><br><span class="line"><span class="string">&quot;오늘은 가족과 함께 보내는 특별한 시간이었다&quot;</span>, <span class="comment"># 긍정</span></span><br><span class="line"><span class="string">&quot;이 책을 읽으며 새로운 영감을 받았다&quot;</span>, <span class="comment"># 긍정</span></span><br><span class="line"><span class="string">&quot;비가 오는 날은 항상 우울하고 힘든 날이다&quot;</span>, <span class="comment"># 부정</span></span><br><span class="line"><span class="string">&quot;일상적인 일들에 지친 마음이 휘청거린다&quot;</span>, <span class="comment"># 부정</span></span><br><span class="line"><span class="string">&quot;아침에 커피 한 잔과 함께 책을 읽는 것이 나의 일상이다&quot;</span>, <span class="comment"># 중립</span></span><br><span class="line"><span class="string">&quot;도시 속에서 바쁜 하루를 보내며 새로운 사람들을 만났다&quot;</span> <span class="comment"># 중립    </span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 감성 분석을 수행할 때 사용할 지침(페르소나, 프롬프트)을 정의</span></span><br><span class="line">persona = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">### Role: 감성 분류 ###</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Instruction ###</span></span><br><span class="line"><span class="string">- 주어진 문장을 &#x27;긍정&#x27;, &#x27;부정&#x27;, &#x27;중립&#x27;인지 판단해줘.</span></span><br><span class="line"><span class="string">- 추가적인 설명은 필요없고 감성 분류 결과만 알려줘.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 결과를 JSON 형식으로 출력 설정</span></span><br><span class="line"><span class="comment"># Instruction에 JSON 형태로 출력하라는 내용과 Output에 JSON Format을 기재해 주어야 함 </span></span><br><span class="line">persona_json = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">### Role: 감성 분류 ###</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Instruction ###</span></span><br><span class="line"><span class="string">- - 주어진 문장을 &#x27;긍정&#x27;, &#x27;부정&#x27;, &#x27;중립&#x27;인지 판단해줘.</span></span><br><span class="line"><span class="string">- 추가적인 설명은 필요없고 감성 분류 결과만 알려줘.</span></span><br><span class="line"><span class="string">- 결과는 JSON 형태로 출력해줘.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### Output ###</span></span><br><span class="line"><span class="string">&#123;&quot;Sentiment&quot;: $sentiment&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>    </span><br><span class="line"></span><br><span class="line"><span class="comment"># 일반 출력</span></span><br><span class="line"><span class="keyword">for</span> sentence <span class="keyword">in</span> sentences:</span><br><span class="line">    get_sentiment(sentence, persona)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p><img src="/images/OenAI-JSON-Mode/01.PNG"></p>
<pre><code class="python"># JSON 출력
for sentence in sentences:
    get_sentiment(sentence, persona_json)
    print(&#39;&#39;)
</code></pre>
<p><img src="/images/OenAI-JSON-Mode/02.PNG"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://axa123-moon.github.io/2024/04/01/TF-IDF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="axa123">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/04/01/TF-IDF/" class="post-title-link" itemprop="url">TF IDF</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-04-01 14:02:40 / Modified: 21:30:55" itemprop="dateCreated datePublished" datetime="2024-04-01T14:02:40+09:00">2024-04-01</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="TF-IDF-Term-Frequency-Inverse-Document-Frequency"><a href="#TF-IDF-Term-Frequency-Inverse-Document-Frequency" class="headerlink" title="TF-IDF (Term Frequency-Inverse Document Frequency)"></a>TF-IDF (Term Frequency-Inverse Document Frequency)</h1><ul>
<li>Document Term Matrix(DTM) 내 단어마다 중요도를 고려하여 가중치를 주는 통계적인 단어 표현방법</li>
</ul>
<h2 id="1-TF-IDF-계산방법"><a href="#1-TF-IDF-계산방법" class="headerlink" title="1. TF-IDF 계산방법"></a>1. TF-IDF 계산방법</h2><ul>
<li>TF-IDF &#x3D; TF * IDF</li>
</ul>
<h2 id="2-TF-Term-Frequency"><a href="#2-TF-Term-Frequency" class="headerlink" title="2. TF (Term Frequency)"></a>2. TF (Term Frequency)</h2><ul>
<li>특정 문서 d 에서 특정 단어 t의 출현빈도</li>
<li>tf(d, t)</li>
</ul>
<p>문서1 : 사과가 맛있다<br>문서2 : 사과 가격이 비싸다<br>문서3 : 아침에 사과가 좋다<br>문서4 : 배 가격이 사과 가격보다 비싸다</p>
<p><img src="/images/TFIDF/01.PNG"></p>
<h2 id="3-DF-Document-Frequency"><a href="#3-DF-Document-Frequency" class="headerlink" title="3. DF (Document Frequency)"></a>3. DF (Document Frequency)</h2><ul>
<li>특정 단어 t가 등장한 문서의 수</li>
<li>df(t)</li>
</ul>
<p><img src="/images/TFIDF/02.PNG"></p>
<h2 id="4-IDF-Inverse-Document-Frequency"><a href="#4-IDF-Inverse-Document-Frequency" class="headerlink" title="4. IDF (Inverse Document Frequency)"></a>4. IDF (Inverse Document Frequency)</h2><ul>
<li>DF에 역수</li>
<li>여러 문서에서 등장한 단어의 가중치를 낮추는 역할</li>
<li>log 안의 식에서 분모에 1을 더해주는 이유는 특정 단어가 전체 문서에서 등장하지 않을 경우에 분모가 0이 되는것을 방지</li>
<li>D : 문서 갯수<br>idf(d,t) &#x3D; log(D&#x2F;(1 + df(t)))</li>
</ul>
<p>맛있다의 경우<br>0.693147 &#x3D; log(4&#x2F;(1+1))</p>
<p><img src="/images/TFIDF/04.PNG"></p>
<h2 id="5-TF-IDF"><a href="#5-TF-IDF" class="headerlink" title="5. TF-IDF"></a>5. TF-IDF</h2><ul>
<li>TF-IDF &#x3D; TF * IDF<br><img src="/images/TFIDF/03.PNG"></li>
</ul>
<h2 id="6-Coding"><a href="#6-Coding" class="headerlink" title="6. Coding"></a>6. Coding</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> sklearn.feature_extraction.text <span class="keyword">import</span> CountVectorizer</span><br><span class="line"></span><br><span class="line">documents = [</span><br><span class="line">    <span class="string">&quot;사과가 맛있다&quot;</span>,</span><br><span class="line">    <span class="string">&quot;사과 가격이 비싸다&quot;</span>,</span><br><span class="line">    <span class="string">&quot;아침에 사과가 좋다&quot;</span>,</span><br><span class="line">    <span class="string">&quot;배 가격이 사과 가격보다 비싸다&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">cv = CountVectorizer()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Document Term Matrix</span></span><br><span class="line">X = cv.fit_transform(documents).toarray()</span><br><span class="line"></span><br><span class="line"><span class="comment"># get the feature names</span></span><br><span class="line">features = cv.get_feature_names_out()</span><br><span class="line"></span><br><span class="line"><span class="comment"># create a DataFrame from the bag of words representation</span></span><br><span class="line">tf = pd.DataFrame(X, columns=features)</span><br><span class="line">tf</span><br></pre></td></tr></table></figure>
<p><img src="/images/TFIDF/01.PNG"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Document Frequency </span></span><br><span class="line">df = tf.astype(<span class="built_in">bool</span>).<span class="built_in">sum</span>(axis = <span class="number">0</span>)</span><br><span class="line">df</span><br></pre></td></tr></table></figure>
<p><img src="/images/TFIDF/02.PNG"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 문서 개수</span></span><br><span class="line">D = <span class="built_in">len</span>(tf)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Inverse Document Frequency</span></span><br><span class="line">idf = np.log((D) / (df+<span class="number">1</span>))</span><br><span class="line">idf</span><br></pre></td></tr></table></figure>
<p><img src="/images/TFIDF/04.PNG"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># TF-IDF</span></span><br><span class="line">tfidf = tf * idf                      </span><br><span class="line"><span class="comment">#tfidf = tfidf / np.linalg.norm(tfidf, axis = 1, keepdims = True)</span></span><br><span class="line">tfidf</span><br></pre></td></tr></table></figure>
<p><img src="/images/TFIDF/03.PNG"></p>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a target="_blank" rel="noopener" href="https://m.blog.naver.com/mk_crew/222070694314">https://m.blog.naver.com/mk_crew/222070694314</a><br><a target="_blank" rel="noopener" href="https://heytech.tistory.com/337">https://heytech.tistory.com/337</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://axa123-moon.github.io/2024/03/27/Text-Preprocessing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="axa123">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/03/27/Text-Preprocessing/" class="post-title-link" itemprop="url">Text Preprocessing</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-03-27 17:00:31 / Modified: 17:53:31" itemprop="dateCreated datePublished" datetime="2024-03-27T17:00:31+09:00">2024-03-27</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Text-Preprocessing"><a href="#Text-Preprocessing" class="headerlink" title="Text Preprocessing"></a>Text Preprocessing</h1><ol>
<li>Tokenization<br>  1.1. 단어 토큰화<br>  1.2. 문장 토큰화</li>
<li>Cleaning</li>
<li>Normalization<br>  3.1. Stemming<br>  3.2. Lemmatization</li>
<li>Edit Distance</li>
</ol>
<h2 id="1-Tokenization"><a href="#1-Tokenization" class="headerlink" title="1. Tokenization"></a>1. Tokenization</h2><ul>
<li>주어진 데이터를 토큰(Token)이라 불리는 단위로 나누는 작업</li>
</ul>
<h3 id="1-1-단어-토큰화"><a href="#1-1-단어-토큰화" class="headerlink" title="1.1  단어 토큰화"></a>1.1  단어 토큰화</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line">nltk.download(<span class="string">&#x27;punkt&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> nltk.tokenize <span class="keyword">import</span> word_tokenize</span><br><span class="line"><span class="keyword">from</span> nltk.tokenize <span class="keyword">import</span> WordPunctTokenizer</span><br><span class="line"><span class="keyword">from</span> nltk.tokenize <span class="keyword">import</span> TreebankWordTokenizer</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">&quot;Although we may not be fully aware of natural language, we need to master several preprocessing techniques to perform natural language processing.&quot;</span></span><br><span class="line"></span><br><span class="line">word_tokenize(text)</span><br></pre></td></tr></table></figure>

<p>[‘Although’,<br> ‘we’,<br> ‘may’,<br> ‘not’,<br> ‘be’,<br> ‘fully’,<br> ‘aware’,<br> ‘of’,<br> ‘natural’,<br> ‘language’,<br> ‘,’,<br> ‘we’,<br> ‘need’,<br> ‘to’,<br> ‘master’,<br> ‘several’,<br> ‘preprocessing’,<br> ‘techniques’,<br> ‘to’,<br> ‘perform’,<br> ‘natural’,<br> ‘language’,<br> ‘processing’,<br> ‘.’]</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">punct_tokenizer = WordPunctTokenizer() </span><br><span class="line">punct_tokenizer.tokenize(text)</span><br></pre></td></tr></table></figure>
<p>[‘Although’,<br> ‘we’,<br> ‘may’,<br> ‘not’,<br> ‘be’,<br> ‘fully’,<br> ‘aware’,<br> ‘of’,<br> ‘natural’,<br> ‘language’,<br> ‘,’,<br> ‘we’,<br> ‘need’,<br> ‘to’,<br> ‘master’,<br> ‘several’,<br> ‘preprocessing’,<br> ‘techniques’,<br> ‘to’,<br> ‘perform’,<br> ‘natural’,<br> ‘language’,<br> ‘processing’,<br> ‘.’]</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tree_tokenizer = TreebankWordTokenizer()</span><br><span class="line">tree_tokenizer.tokenize(text)</span><br></pre></td></tr></table></figure>

<p>[‘Although’,<br> ‘we’,<br> ‘may’,<br> ‘not’,<br> ‘be’,<br> ‘fully’,<br> ‘aware’,<br> ‘of’,<br> ‘natural’,<br> ‘language’,<br> ‘,’,<br> ‘we’,<br> ‘need’,<br> ‘to’,<br> ‘master’,<br> ‘several’,<br> ‘preprocessing’,<br> ‘techniques’,<br> ‘to’,<br> ‘perform’,<br> ‘natural’,<br> ‘language’,<br> ‘processing’,<br> ‘.’]</p>
<h3 id="1-2-문장-토큰화"><a href="#1-2-문장-토큰화" class="headerlink" title="1.2  문장 토큰화"></a>1.2  문장 토큰화</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sentences = <span class="string">&quot;NLP stands for Natural Language Processing. \</span></span><br><span class="line"><span class="string">It is a branch of artificial intelligence that focuses on the interaction between computers and human languages. \</span></span><br><span class="line"><span class="string">NLP combines techniques from linguistics, computer science, and machine learning to enable computers to understand and interpret. \</span></span><br><span class="line"><span class="string">And it creates human language in a meaningful and useful way.&quot;</span></span><br><span class="line"></span><br><span class="line">nltk.sent_tokenize(sentences)</span><br></pre></td></tr></table></figure>

<p>[‘NLP stands for Natural Language Processing.’,<br> ‘It is a branch of artificial intelligence that focuses on the interaction between computers and human languages.’,<br> ‘NLP combines techniques from linguistics, computer science, and machine learning to enable computers to understand and interpret.’,<br> ‘And it creates human language in a meaningful and useful way.’]</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sentences = <span class="string">&quot;I am actively looking for Ph.D. students. and you are a Ph.D student.&quot;</span></span><br><span class="line">nltk.sent_tokenize(sentences)</span><br></pre></td></tr></table></figure>

<p>[‘I am actively looking for Ph.D. students.’, ‘and you are a Ph.D student.’]</p>
<h2 id="2-Cleaning"><a href="#2-Cleaning" class="headerlink" title="2. Cleaning"></a>2. Cleaning</h2><ul>
<li>토큰화 작업에 방해가 되거나 의미가 없는 부분의 텍스트, 노이즈를 제거</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"><span class="keyword">from</span> nltk.corpus <span class="keyword">import</span> stopwords</span><br><span class="line">nltk.download(<span class="string">&#x27;stopwords&#x27;</span>)</span><br><span class="line"></span><br><span class="line">stop=<span class="built_in">set</span>(stopwords.words(<span class="string">&#x27;english&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(stop)</span><br></pre></td></tr></table></figure>

<p>{‘i’, ‘don’, ‘just’, ‘been’, ‘into’, ‘ve’, ‘should’, ‘this’, “shouldn’t”, ‘yours’, ‘but’, “aren’t”, ‘your’, ‘about’, “needn’t”, ‘m’, ‘itself’, ‘other’, ‘wasn’, “wouldn’t”, ‘too’, ‘haven’, “doesn’t”, “mightn’t”, ‘hasn’, ‘didn’, ‘once’, ‘and’, “you’ll”, ‘won’, ‘we’, ‘his’, ‘both’, ‘needn’, “you’re”, ‘do’, ‘how’, ‘me’, ‘further’, ‘ain’, ‘an’, ‘isn’, ‘herself’, “wasn’t”, ‘their’, “you’ve”, ‘yourself’, ‘against’, ‘while’, ‘down’, ‘had’, ‘up’, ‘over’, ‘any’, ‘him’, ‘being’, ‘you’, ‘than’, ‘out’, “hasn’t”, ‘more’, ‘off’, ‘can’, “it’s”, ‘is’, ‘during’, ‘aren’, ‘the’, “haven’t”, ‘then’, ‘these’, ‘them’, ‘be’, ‘shan’, ‘whom’, ‘has’, ‘under’, ‘such’, ‘ll’, ‘no’, ‘all’, ‘they’, ‘through’, ‘am’, “you’d”, “weren’t”, ‘wouldn’, ‘with’, ‘in’, ‘my’, ‘on’, ‘that’, ‘if’, ‘was’, ‘why’, ‘ours’, ‘did’, ‘only’, “she’s”, ‘her’, ‘own’, ‘mightn’, ‘mustn’, ‘y’, ‘s’, ‘not’, “isn’t”, ‘where’, ‘few’, ‘by’, ‘our’, ‘so’, ‘most’, ‘of’, ‘because’, ‘have’, ‘re’, ‘as’, ‘are’, “shan’t”, ‘having’, ‘a’, ‘ourselves’, ‘which’, ‘to’, ‘from’, ‘each’, ‘or’, ‘until’, ‘t’, ‘who’, ‘d’, ‘there’, ‘doesn’, ‘himself’, ‘what’, ‘here’, ‘hers’, ‘at’, “didn’t”, ‘hadn’, ‘were’, ‘below’, ‘very’, ‘ma’, ‘now’, ‘it’, ‘those’, ‘some’, ‘themselves’, “that’ll”, ‘does’, ‘shouldn’, ‘between’, ‘when’, ‘after’, ‘myself’, ‘theirs’, ‘doing’, ‘again’, ‘o’, ‘yourselves’, ‘for’, “won’t”, “hadn’t”, ‘same’, “mustn’t”, ‘she’, ‘nor’, ‘above’, “should’ve”, ‘couldn’, “couldn’t”, ‘he’, ‘will’, “don’t”, ‘weren’, ‘its’, ‘before’}</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sentence=<span class="string">&quot;I want to go shopping and buy snacks&quot;</span></span><br><span class="line">tokens=nltk.word_tokenize(sentence)</span><br><span class="line"></span><br><span class="line">clean_tokens=[]</span><br><span class="line"><span class="keyword">for</span> tok <span class="keyword">in</span> tokens:</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">len</span>(tok.lower())&gt;<span class="number">1</span> <span class="keyword">and</span> (tok.lower() <span class="keyword">not</span> <span class="keyword">in</span> stop): </span><br><span class="line">    clean_tokens.append(tok) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;정상 문장: &quot;</span>,tokens)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;불용어 제거: &quot;</span>,clean_tokens)</span><br></pre></td></tr></table></figure>

<p>정상 문장:  [‘I’, ‘want’, ‘to’, ‘go’, ‘shopping’, ‘and’, ‘buy’, ‘snacks’]<br>불용어 제거:  [‘want’, ‘go’, ‘shopping’, ‘buy’, ‘snacks’]</p>
<h2 id="3-Normalization"><a href="#3-Normalization" class="headerlink" title="3. Normalization"></a>3. Normalization</h2><ul>
<li>의미가 중복되거나 의미론적으로 유사한 단어들을 하나로 통합하거나, 단어의 원형을 찾아 통일해주는 작업</li>
</ul>
<h3 id="3-1-Stemming-어간-추출"><a href="#3-1-Stemming-어간-추출" class="headerlink" title="3.1. Stemming (어간 추출)"></a>3.1. Stemming (어간 추출)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> nltk.stem <span class="keyword">import</span> PorterStemmer</span><br><span class="line"><span class="keyword">from</span> nltk.tokenize <span class="keyword">import</span> word_tokenize</span><br><span class="line"></span><br><span class="line">stem = PorterStemmer() <span class="comment"># stemmer 선언</span></span><br><span class="line">text = <span class="string">&quot;This was not the map we found on Billy Bonds&#x27; chest, but the exact copy of everything, name and height and sound, except for the red cross and the written note.&quot;</span></span><br><span class="line">words = word_tokenize(text)</span><br><span class="line"><span class="built_in">print</span>(words)</span><br></pre></td></tr></table></figure>

<p>[‘This’, ‘was’, ‘not’, ‘the’, ‘map’, ‘we’, ‘found’, ‘on’, ‘Billy’, ‘Bonds’, “‘“, ‘chest’, ‘,’, ‘but’, ‘the’, ‘exact’, ‘copy’, ‘of’, ‘everything’, ‘,’, ‘name’, ‘and’, ‘height’, ‘and’, ‘sound’, ‘,’, ‘except’, ‘for’, ‘the’, ‘red’, ‘cross’, ‘and’, ‘the’, ‘written’, ‘note’, ‘.’]</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> words:</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;i&#125;</span> --&gt; <span class="subst">&#123;stem.stem(i)&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>This –&gt; thi<br>was –&gt; wa<br>not –&gt; not<br>the –&gt; the<br>map –&gt; map<br>we –&gt; we<br>found –&gt; found<br>on –&gt; on<br>Billy –&gt; billi<br>Bonds –&gt; bond<br>‘ –&gt; ‘<br>chest –&gt; chest<br>, –&gt; ,<br>but –&gt; but<br>the –&gt; the<br>exact –&gt; exact<br>copy –&gt; copi<br>of –&gt; of<br>everything –&gt; everyth<br>, –&gt; ,<br>name –&gt; name<br>and –&gt; and<br>height –&gt; height<br>and –&gt; and<br>sound –&gt; sound<br>, –&gt; ,<br>except –&gt; except<br>for –&gt; for<br>the –&gt; the<br>red –&gt; red<br>cross –&gt; cross<br>and –&gt; and<br>the –&gt; the<br>written –&gt; written<br>note –&gt; note<br>. –&gt; .</p>
<h2 id="3-2-Lemmatization-원형-추출"><a href="#3-2-Lemmatization-원형-추출" class="headerlink" title="3.2. Lemmatization (원형 추출)"></a>3.2. Lemmatization (원형 추출)</h2><ul>
<li>문장 속에서 다양한 형태로 활용된(inflected) 단어의 표제어(lemma)를 찾는 일</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> nltk.stem <span class="keyword">import</span> WordNetLemmatizer</span><br><span class="line">nltk.download(<span class="string">&#x27;wordnet&#x27;</span>)</span><br><span class="line"></span><br><span class="line">l = WordNetLemmatizer() </span><br><span class="line">words = [<span class="string">&#x27;doing&#x27;</span>, <span class="string">&#x27;has&#x27;</span>, <span class="string">&#x27;going&#x27;</span>, <span class="string">&#x27;loves&#x27;</span>, <span class="string">&#x27;lives&#x27;</span>, <span class="string">&#x27;flying&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> words:</span><br><span class="line">  lemma = l.lemmatize(i, pos=<span class="string">&#x27;v&#x27;</span>)</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;i&#125;</span> --&gt; <span class="subst">&#123;lemma&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>doing –&gt; do<br>has –&gt; have<br>going –&gt; go<br>loves –&gt; love<br>lives –&gt; live<br>flying –&gt; fly</p>
<h2 id="4-Edit-Distance"><a href="#4-Edit-Distance" class="headerlink" title="4. Edit Distance"></a>4. Edit Distance</h2><ul>
<li>2개의 문자열이 얼만큼 다른가를 거리개념으로 치환해 숫자로 표현한 것. 삽입, 삭제, 교체 연산이 존재함.</li>
<li>heat 과  hit 두단어의 차이는 2입니다.</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> nltk</span><br><span class="line"><span class="keyword">from</span> nltk.metrics <span class="keyword">import</span> edit_distance</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(edit_distance(<span class="string">&quot;heat&quot;</span>,<span class="string">&quot;hit&quot;</span>))</span><br></pre></td></tr></table></figure>
<p>2</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://axa123-moon.github.io/2024/03/08/ROUGE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="axa123">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/03/08/ROUGE/" class="post-title-link" itemprop="url">ROUGE</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-03-08 09:18:42 / Modified: 10:20:25" itemprop="dateCreated datePublished" datetime="2024-03-08T09:18:42+09:00">2024-03-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="ROUGE"><a href="#ROUGE" class="headerlink" title="ROUGE"></a>ROUGE</h1><ul>
<li>평가지표는 ROUGE(Recall-Oriented Understudy for Gisting Evaluation) 사용</li>
<li>텍스트 자동 요약, 기계 번역 등 자연어 생성 모델의 성능을 평가하기 위한 지표이며, 모델이 생성한 요약본 혹은 번역본을 사람이 미리 만들어 놓은 참조본과 대조해 성능 점수를 계산함</li>
</ul>
<p><img src="/images/Rouge/01.PNG"></p>
<h3 id="Recall과-Precesion"><a href="#Recall과-Precesion" class="headerlink" title="Recall과 Precesion"></a>Recall과 Precesion</h3><p><img src="/images/Rouge/02.PNG"></p>
<h3 id="ROUGE-1"><a href="#ROUGE-1" class="headerlink" title="ROUGE-1"></a>ROUGE-1</h3><ul>
<li>한 단어 기준으로 정답과 예측의 결과를 계산함</li>
</ul>
<p>정답 : <strong>the cat was under the bed</strong><br>예측 : <strong>the cat was</strong> found <strong>under the bed</strong></p>
<p><img src="/images/Rouge/03.PNG"></p>
<h3 id="ROUGE-2"><a href="#ROUGE-2" class="headerlink" title="ROUGE-2"></a>ROUGE-2</h3><ul>
<li>연속 두단어 기준으로 정답과 예측의 결과를 계산함</li>
</ul>
<p>정답 : <strong>[the cat]</strong> [cat was] [was under] <strong>[under the] [the bed]</strong><br>예측 : <strong>[under the] [the bed]</strong> [bed there] [there was] [was the] <strong>[the cat]</strong></p>
<p><img src="/images/Rouge/04.PNG"></p>
<h3 id="ROUGE-L"><a href="#ROUGE-L" class="headerlink" title="ROUGE-L"></a>ROUGE-L</h3><ul>
<li>가장 긴 공통부분 문자열의 길이를 기준으로 정답과 예측의 결과를 계산함</li>
</ul>
<p>정답 : the cat was <strong>under the bed</strong><br>예측 : <strong>under the bed</strong> there was the cat</p>
<p><img src="/images/Rouge/05.PNG"></p>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a target="_blank" rel="noopener" href="https://yumdata.tistory.com/435">https://yumdata.tistory.com/435</a><br><a target="_blank" rel="noopener" href="https://velog.io/@yoonene/ROUGE-Score%EB%9E%80">https://velog.io/@yoonene/ROUGE-Score%EB%9E%80</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://axa123-moon.github.io/2024/03/06/NLP-Pipeline/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="axa123">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/03/06/NLP-Pipeline/" class="post-title-link" itemprop="url">NLP Pipeline</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-03-06 18:20:41" itemprop="dateCreated datePublished" datetime="2024-03-06T18:20:41+09:00">2024-03-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-03-07 13:01:04" itemprop="dateModified" datetime="2024-03-07T13:01:04+09:00">2024-03-07</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Huggingface를-이용한-자연어-처리"><a href="#Huggingface를-이용한-자연어-처리" class="headerlink" title="Huggingface를 이용한 자연어 처리"></a>Huggingface를 이용한 자연어 처리</h1><h3 id="파이프라인-전체-구조"><a href="#파이프라인-전체-구조" class="headerlink" title="파이프라인 전체 구조"></a>파이프라인 전체 구조</h3><ol>
<li><strong>환경설정</strong><ul>
<li>라이브러리 설치 및 데이터셋 로드<br><br></li>
</ul>
</li>
<li><strong>데이터셋 구축</strong><ul>
<li>입력 데이터를 train과 valid로 나누고, 토크나이징 하여 torch dataset class로 변환</li>
<li>모델이 사용할 수 있는 데이터 구조로 변경함<br><br></li>
</ul>
</li>
<li><strong>모델 및 tokenizer 가져오기</strong><ul>
<li>Huggingface의 사전학습된 (Pre-trained) 모델 로드</li>
<li>사전학습된 모델과 tokenizer는 동일한 체크포인트(checkpoing)여야 학습가능함<br><br></li>
</ul>
</li>
<li><strong>모델 학습</strong><ul>
<li>Huggingface의 TrainingArguments 와 Trainer를 활용하여 학습데이터(train &#x2F; valid)로 모델 학습</li>
<li>Trainer를 사용하면 배치학습(Batch Learning), 학습 스케줄러(Learning Scheduler), 학습 조기종료(EarlyStopping)들의 기능을 간단히 사용할 수 있음<br><br></li>
</ul>
</li>
<li><strong>추론 및 평가</strong><ul>
<li>학습된 (Fine-tuned)모델을 통해 Test 데이터 추록 및 평가 진행<br><br></li>
</ul>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://axa123-moon.github.io/2024/03/04/Confusion-matrix/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="axa123">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/03/04/Confusion-matrix/" class="post-title-link" itemprop="url">Confusion matrix</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2024-03-04 17:07:29" itemprop="dateCreated datePublished" datetime="2024-03-04T17:07:29+09:00">2024-03-04</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-03-08 09:16:46" itemprop="dateModified" datetime="2024-03-08T09:16:46+09:00">2024-03-08</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Confusion-Matrix"><a href="#Confusion-Matrix" class="headerlink" title="Confusion Matrix"></a>Confusion Matrix</h1><ul>
<li>분류 모델의 성능을 평가하기 위해 실제 값과 모델이 예측한 값을 대조하는 표</li>
</ul>
<p><img src="/images/ConfusionMatrix/01.PNG"></p>
<pre><code>- TP : (모델이) 맞았다고 했는데(실제로) 맞은 것
- FN : (모델이) 틀렸다고 했는데 (실제로) 맞은 것
- FP : (모델이) 맞았다고 했는데 (실제로) 틀린 것
- TN : (모델이) 틀렸다고 했는데 (실제로) 틀린 것
</code></pre>
<h3 id="Accuracy-정확도"><a href="#Accuracy-정확도" class="headerlink" title="Accuracy(정확도)"></a>Accuracy(정확도)</h3><ul>
<li>(모델이) 예측한 것들 중에 (실제와) 일치한 것 비율<ul>
<li>TP+TN &#x2F; (TP+FP+FN+TN)</li>
</ul>
</li>
</ul>
<h3 id="Precision-정밀도"><a href="#Precision-정밀도" class="headerlink" title="Precision(정밀도)"></a>Precision(정밀도)</h3><ul>
<li>긍정으로 예측한 것 중 실제로 맞춘 비율<ul>
<li>TP &#x2F; (TP+FP)</li>
</ul>
</li>
</ul>
<h4 id="예시"><a href="#예시" class="headerlink" title="예시"></a>예시</h4><p><img src="/images/ConfusionMatrix/02.PNG"></p>
<h3 id="Recall-재현율"><a href="#Recall-재현율" class="headerlink" title="Recall(재현율)"></a>Recall(재현율)</h3><ul>
<li>(실제) 맞는 것들 중에 (모델이) 맞았다고 예측한 비율<ul>
<li>TP &#x2F; (TP + FN)</li>
</ul>
</li>
</ul>
<h4 id="예시-1"><a href="#예시-1" class="headerlink" title="예시"></a>예시</h4><p><img src="/images/ConfusionMatrix/03.PNG"></p>
<p><img src="/images/ConfusionMatrix/05.PNG"></p>
<h3 id="F1-score"><a href="#F1-score" class="headerlink" title="F1-score"></a>F1-score</h3><ul>
<li>Precision과 Recall 의 조화평균으로, 두가지 지표를 모두 고려하는 평가지표</li>
<li>불균형한 데이터에서 Accuracy 보다 효과적인 평가지표<ul>
<li>2 * (recall * precision) &#x2F; (recall + precision)</li>
</ul>
</li>
</ul>
<h4 id="예시-2"><a href="#예시-2" class="headerlink" title="예시"></a>예시</h4><p><img src="/images/ConfusionMatrix/04.PNG"></p>
<h3 id="References"><a href="#References" class="headerlink" title="References"></a>References</h3><p><a target="_blank" rel="noopener" href="https://yumdata.tistory.com/361">https://yumdata.tistory.com/361</a><br><a target="_blank" rel="noopener" href="https://dojinkimm.github.io/ml/2019/10/26/handson-ch3.html">https://dojinkimm.github.io/ml/2019/10/26/handson-ch3.html</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://axa123-moon.github.io/2024/02/26/CAM-Visualization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="axa123">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/02/26/CAM-Visualization/" class="post-title-link" itemprop="url">CAM Visualization</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-02-26 12:58:15 / Modified: 16:30:06" itemprop="dateCreated datePublished" datetime="2024-02-26T12:58:15+09:00">2024-02-26</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="모델별-시각화"><a href="#모델별-시각화" class="headerlink" title="모델별 시각화"></a>모델별 시각화</h1><ul>
<li>모델들에 대한 시각화하기</li>
<li>grad-cam 라이브러리를 이용한 CAM 시각화</li>
</ul>
<h3 id="Contents"><a href="#Contents" class="headerlink" title="Contents"></a>Contents</h3><ul>
<li>Library Import</li>
<li>Model 및 Image Load</li>
<li>Image Visualization</li>
<li>CAM Visualization</li>
</ul>
<h2 id="1-Library-Import"><a href="#1-Library-Import" class="headerlink" title="1. Library Import"></a>1. Library Import</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line">warnings.simplefilter(<span class="string">&#x27;ignore&#x27;</span>)</span><br><span class="line"><span class="keyword">from</span> torchvision.models.segmentation <span class="keyword">import</span> deeplabv3_resnet50</span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.functional <span class="keyword">as</span> F</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> pytorch_grad_cam.utils.image <span class="keyword">import</span> show_cam_on_image, preprocess_image</span><br></pre></td></tr></table></figure>

<h2 id="2-Model-및-image-Load"><a href="#2-Model-및-image-Load" class="headerlink" title="2. Model 및 image Load"></a>2. Model 및 image Load</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">image_url = <span class="string">&quot;https://farm1.staticflickr.com/6/9606553_ccc7518589_z.jpg&quot;</span></span><br><span class="line">image = np.array(Image.<span class="built_in">open</span>(requests.get(image_url, stream=<span class="literal">True</span>).raw))</span><br><span class="line">rgb_img = np.float32(image) / <span class="number">255</span></span><br><span class="line">input_tensor = preprocess_image(rgb_img,</span><br><span class="line">                                mean=[<span class="number">0.485</span>, <span class="number">0.456</span>, <span class="number">0.406</span>],</span><br><span class="line">                                std=[<span class="number">0.229</span>, <span class="number">0.224</span>, <span class="number">0.225</span>])</span><br><span class="line"><span class="comment"># Taken from the torchvision tutorial</span></span><br><span class="line"><span class="comment"># https://pytorch.org/vision/stable/auto_examples/plot_visualization_utils.html</span></span><br><span class="line">model = deeplabv3_resnet50(pretrained=<span class="literal">True</span>, progress=<span class="literal">False</span>)</span><br><span class="line">model = model.<span class="built_in">eval</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> torch.cuda.is_available():</span><br><span class="line">    model = model.cuda()</span><br><span class="line">    input_tensor = input_tensor.cuda()</span><br><span class="line"></span><br><span class="line">output = model(input_tensor)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(output), output.keys())</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SegmentationModelOutputWrapper</span>(torch.nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, model</span>): </span><br><span class="line">        <span class="built_in">super</span>(SegmentationModelOutputWrapper, self).__init__()</span><br><span class="line">        self.model = model</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="keyword">return</span> self.model(x)[<span class="string">&quot;out&quot;</span>]</span><br><span class="line">    </span><br><span class="line">model = SegmentationModelOutputWrapper(model)</span><br><span class="line">output = model(input_tensor)</span><br></pre></td></tr></table></figure>

<h2 id="3-Image-Visualization"><a href="#3-Image-Visualization" class="headerlink" title="3.  Image Visualization"></a>3.  Image Visualization</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">normalized_masks = torch.nn.functional.softmax(output, dim=<span class="number">1</span>).cpu()</span><br><span class="line">sem_classes = [</span><br><span class="line">    <span class="string">&#x27;__background__&#x27;</span>, <span class="string">&#x27;aeroplane&#x27;</span>, <span class="string">&#x27;bicycle&#x27;</span>, <span class="string">&#x27;bird&#x27;</span>, <span class="string">&#x27;boat&#x27;</span>, <span class="string">&#x27;bottle&#x27;</span>, <span class="string">&#x27;bus&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;car&#x27;</span>, <span class="string">&#x27;cat&#x27;</span>, <span class="string">&#x27;chair&#x27;</span>, <span class="string">&#x27;cow&#x27;</span>, <span class="string">&#x27;diningtable&#x27;</span>, <span class="string">&#x27;dog&#x27;</span>, <span class="string">&#x27;horse&#x27;</span>, <span class="string">&#x27;motorbike&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;person&#x27;</span>, <span class="string">&#x27;pottedplant&#x27;</span>, <span class="string">&#x27;sheep&#x27;</span>, <span class="string">&#x27;sofa&#x27;</span>, <span class="string">&#x27;train&#x27;</span>, <span class="string">&#x27;tvmonitor&#x27;</span></span><br><span class="line">]</span><br><span class="line">sem_class_to_idx = &#123;cls: idx <span class="keyword">for</span> (idx, cls) <span class="keyword">in</span> <span class="built_in">enumerate</span>(sem_classes)&#125;</span><br><span class="line"></span><br><span class="line">car_category = sem_class_to_idx[<span class="string">&quot;car&quot;</span>]</span><br><span class="line">car_mask = normalized_masks[<span class="number">0</span>, :, :, :].argmax(axis=<span class="number">0</span>).detach().cpu().numpy()</span><br><span class="line">car_mask_uint8 = <span class="number">255</span> * np.uint8(car_mask == car_category)</span><br><span class="line">car_mask_float = np.float32(car_mask == car_category)</span><br><span class="line"></span><br><span class="line">both_images = np.hstack((image, np.repeat(car_mask_uint8[:, :, <span class="literal">None</span>], <span class="number">3</span>, axis=-<span class="number">1</span>)))</span><br><span class="line">Image.fromarray(both_images)</span><br></pre></td></tr></table></figure>

<p><img src="/images/CAMVisualization/01.PNG"></p>
<h2 id="4-CAM-Visualization"><a href="#4-CAM-Visualization" class="headerlink" title="4.  CAM Visualization"></a>4.  CAM Visualization</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pytorch_grad_cam <span class="keyword">import</span> GradCAM</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SemanticSegmentationTarget</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, category, mask</span>):</span><br><span class="line">        self.category = category</span><br><span class="line">        self.mask = torch.from_numpy(mask)</span><br><span class="line">        <span class="keyword">if</span> torch.cuda.is_available():</span><br><span class="line">            self.mask = self.mask.cuda()</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__call__</span>(<span class="params">self, model_output</span>):</span><br><span class="line">        <span class="keyword">return</span> (model_output[self.category, :, : ] * self.mask).<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">target_layers = [model.model.backbone.layer4]</span><br><span class="line">targets = [SemanticSegmentationTarget(car_category, car_mask_float)]</span><br><span class="line"><span class="keyword">with</span> GradCAM(model=model,</span><br><span class="line">             target_layers=target_layers) <span class="keyword">as</span> cam:</span><br><span class="line">    grayscale_cam = cam(input_tensor=input_tensor,</span><br><span class="line">                        targets=targets)[<span class="number">0</span>, :]</span><br><span class="line">    cam_image = show_cam_on_image(rgb_img, grayscale_cam, use_rgb=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">Image.fromarray(cam_image)</span><br></pre></td></tr></table></figure>
<p><img src="/images/CAMVisualization/02.PNG"></p>
<h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><ul>
<li><a target="_blank" rel="noopener" href="https://jacobgil.github.io/pytorch-gradcam-book/introduction.html">https://jacobgil.github.io/pytorch-gradcam-book/introduction.html</a></li>
<li><a target="_blank" rel="noopener" href="https://csm-kr.tistory.com/74">https://csm-kr.tistory.com/74</a></li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://axa123-moon.github.io/2024/02/23/CNN-layer-visualization/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="axa123">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | AI Beginner's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/02/23/CNN-layer-visualization/" class="post-title-link" itemprop="url">CNN layer visualization</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2024-02-23 16:38:47 / Modified: 18:05:43" itemprop="dateCreated datePublished" datetime="2024-02-23T16:38:47+09:00">2024-02-23</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="CNN-Layer별-시각화"><a href="#CNN-Layer별-시각화" class="headerlink" title="CNN Layer별 시각화"></a>CNN Layer별 시각화</h1><ul>
<li>CNN 각각의 레이어에서 Feature Map 내용 시각화 보기</li>
</ul>
<h3 id="Contents"><a href="#Contents" class="headerlink" title="Contents"></a>Contents</h3><ul>
<li>Library Import</li>
<li>Model Load</li>
<li>Image Load</li>
<li>Save Layer </li>
<li>Layer Visualization</li>
</ul>
<h2 id="1-Library-Import"><a href="#1-Library-Import" class="headerlink" title="1. Library Import"></a>1. Library Import</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> PIL </span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line"><span class="keyword">import</span> torchvision.transforms <span class="keyword">as</span> T</span><br><span class="line"></span><br><span class="line"><span class="comment"># seed 고정</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> torch.backends.cudnn <span class="keyword">as</span> cudnn</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">random_seed</span>(<span class="params">seed_num</span>):</span><br><span class="line">    torch.manual_seed(seed_num)</span><br><span class="line">    torch.cuda.manual_seed(seed_num)</span><br><span class="line">    torch.cuda.manual_seed_all(seed_num)</span><br><span class="line">    cudnn.benchmark = <span class="literal">False</span></span><br><span class="line">    cudnn.deterministic = <span class="literal">True</span></span><br><span class="line">    random.seed(seed_num)</span><br><span class="line"></span><br><span class="line">random_seed(<span class="number">2024</span>)</span><br></pre></td></tr></table></figure>

<h2 id="2-Model-Load"><a href="#2-Model-Load" class="headerlink" title="2. Model Load"></a>2. Model Load</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 원하는 모델을 torch.hub에서 불러옵니다</span></span><br><span class="line">model = torch.hub.load(<span class="string">&#x27;pytorch/vision&#x27;</span>, <span class="string">&#x27;resnet18&#x27;</span>, pretrained=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 가속 환경을 설정해 줍니다</span></span><br><span class="line">device = <span class="string">&#x27;cpu&#x27;</span></span><br><span class="line"><span class="keyword">if</span> torch.cuda.is_available():</span><br><span class="line">    device = <span class="string">&#x27;cuda&#x27;</span></span><br><span class="line">model = model.to(device)</span><br><span class="line"></span><br><span class="line"><span class="comment">#모델을 evaluation mode로 설정해 줍니다</span></span><br><span class="line">model.<span class="built_in">eval</span>()</span><br></pre></td></tr></table></figure>

<h2 id="3-Image-Load"><a href="#3-Image-Load" class="headerlink" title="3. Image Load"></a>3. Image Load</h2><ul>
<li>참고할만한 자료:</li>
</ul>
<ul>
<li><a target="_blank" rel="noopener" href="https://mmlab.ie.cuhk.edu.hk/projects/CelebA.html">CelebA 사이트</a></li>
<li><a target="_blank" rel="noopener" href="https://kr.freepik.com/free-photo/smiling-asian-young-woman-face-portrait_19009019.htm#query=%EC%82%AC%EB%9E%8C%20%EC%96%BC%EA%B5%B4&position=0&from_view=keyword&track=ais&uuid=4aa8a80d-cb2f-4cb1-8630-cc8bdbac6740%22%3E">출처 Freepik 작가 rawpixel.com</a></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">im = Image.<span class="built_in">open</span>(<span class="string">&quot;face3.jpg&quot;</span>)</span><br><span class="line">plt.imshow(im)</span><br></pre></td></tr></table></figure>

<p><img src="/images/CNNlLayerVisualization/01.PNG"></p>
<h2 id="4-Save-Layer"><a href="#4-Save-Layer" class="headerlink" title="4. Save Layer"></a>4. Save Layer</h2><ul>
<li>입력 이미지가 각 convolution layer를 거친 후의 output shape를 확인<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">preprocess = torchvision.transforms.Compose([</span><br><span class="line">    torchvision.transforms.Resize(<span class="number">256</span>),</span><br><span class="line">    torchvision.transforms.CenterCrop(<span class="number">224</span>),</span><br><span class="line">    torchvision.transforms.ToTensor(),</span><br><span class="line">    torchvision.transforms.Normalize(mean=[<span class="number">0.485</span>, <span class="number">0.456</span>, <span class="number">0.406</span>], std=[<span class="number">0.229</span>, <span class="number">0.224</span>, <span class="number">0.225</span>]),</span><br><span class="line">])</span><br><span class="line">im_tensor = preprocess(im)</span><br><span class="line">im_tensor = im_tensor.unsqueeze(<span class="number">0</span>).to(device) <span class="comment"># 이미지를 batch 형태로 바꾸어 줌</span></span><br><span class="line"><span class="comment">#print(im.size, im_tensor.shape)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 저장할 Convolution Layer를 list에 저장</span></span><br><span class="line">conv_layers = []</span><br><span class="line"></span><br><span class="line">model_children = <span class="built_in">list</span>(model.children())</span><br><span class="line"></span><br><span class="line">counter = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 모델을 구성하는 Layer들 중 nn.Conv2d 레이어들의 이름 저장</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(model_children)):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(model_children[i]) == nn.Conv2d:</span><br><span class="line">        counter+=<span class="number">1</span></span><br><span class="line">        conv_layers.append(model_children[i])</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">type</span>(model_children[i]) == nn.Sequential:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(model_children[i])):</span><br><span class="line">            <span class="keyword">for</span> child <span class="keyword">in</span> model_children[i][j].children():</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">type</span>(child) == nn.Conv2d:</span><br><span class="line">                    counter+=<span class="number">1</span></span><br><span class="line">                    conv_layers.append(child)</span><br><span class="line"><span class="comment">#print(f&quot;Total convolution layers: &#123;counter&#125;&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># conv_layer에 저장된 convolution layer를 거친 후의 결과를 outputs에 저장</span></span><br><span class="line"><span class="comment"># outputs에 저장된 결과는 해당 레이어를 거치고 난 다음의 Feature Map을 의미</span></span><br><span class="line">outputs = []</span><br><span class="line">names = []</span><br><span class="line">im_tensor_ = im_tensor</span><br><span class="line"><span class="keyword">for</span> i, layer <span class="keyword">in</span> <span class="built_in">enumerate</span>(conv_layers):</span><br><span class="line">    im_tensor_ = layer(im_tensor_)</span><br><span class="line">    outputs.append(im_tensor_)</span><br><span class="line">    names.append(<span class="built_in">str</span>(layer))</span><br><span class="line"></span><br><span class="line"><span class="comment"># Convolution Layer들을 거치면서 Feature Map의 Shape이 어떻게 달라지는지 확인</span></span><br><span class="line"><span class="comment"># 4개의 conv layer마다 output의 channel 수는 2배가 되고 W,H는 각각 1/2이 됨</span></span><br><span class="line"><span class="keyword">for</span> i, feature_map <span class="keyword">in</span> <span class="built_in">enumerate</span>(outputs):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Output shape of conv-[<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>] layer: <span class="subst">&#123;<span class="built_in">tuple</span>(feature_map.shape)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="/images/CNNlLayerVisualization/02.PNG"></p>
<h2 id="5-Layer-Visualization"><a href="#5-Layer-Visualization" class="headerlink" title="5. Layer Visualization"></a>5. Layer Visualization</h2><ul>
<li>convolution layer를 거친 output을 시각화하기</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 저장한 Feature Map을 시각화하기 위해 전처리</span></span><br><span class="line">processed = []</span><br><span class="line"><span class="keyword">for</span> feature_map <span class="keyword">in</span> outputs:</span><br><span class="line">    feature_map = feature_map.squeeze(<span class="number">0</span>)</span><br><span class="line">    gray_scale = torch.<span class="built_in">sum</span>(feature_map,<span class="number">0</span>)</span><br><span class="line">    gray_scale = gray_scale / feature_map.shape[<span class="number">0</span>]</span><br><span class="line">    processed.append(gray_scale.data.cpu().numpy())</span><br><span class="line"><span class="comment">#for fm in processed:</span></span><br><span class="line"><span class="comment">#    print(fm.shape)</span></span><br><span class="line">    </span><br><span class="line">fig = plt.figure(figsize=(<span class="number">30</span>, <span class="number">35</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(processed)):</span><br><span class="line">    a = fig.add_subplot(<span class="number">5</span>, <span class="number">4</span>, i+<span class="number">1</span>)</span><br><span class="line">    imgplot = plt.imshow(processed[i], cmap=<span class="string">&#x27;gray&#x27;</span>)</span><br><span class="line">    a.axis(<span class="string">&quot;off&quot;</span>)</span><br><span class="line">    a.set_title(names[i].split(<span class="string">&#x27;(&#x27;</span>)[<span class="number">0</span>]+<span class="string">&#x27;-[&#x27;</span>+<span class="built_in">str</span>(i+<span class="number">1</span>)+<span class="string">&#x27;]&#x27;</span>, fontsize=<span class="number">30</span>)</span><br><span class="line"><span class="comment">#plt.savefig(str(&#x27;feature_maps.jpg&#x27;), bbox_inches=&#x27;tight&#x27;)</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/CNNlLayerVisualization/04.PNG"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" title="Next page" aria-label="Next page" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">axa123</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
